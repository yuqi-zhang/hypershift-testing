{
    "metadata": {
        "name": "rendered-worker-4aaf23fc16cf5a1e06414c3d3a34c9c2",
        "uid": "68a229b3-b2d0-4ba8-beae-f849cf8a6c5b",
        "resourceVersion": "6123",
        "generation": 1,
        "annotations": {
            "machineconfiguration.openshift.io/generated-by-controller-version": "14a1ca2cb91ff7e0faf9146b21ba12cd6c652d22",
            "machineconfiguration.openshift.io/release-image-version": "4.10.0-rc.2"
        },
        "ownerReferences": [
            {
                "apiVersion": "machineconfiguration.openshift.io/v1",
                "kind": "MachineConfigPool",
                "name": "worker",
                "uid": "9eb65260-2906-47ff-a781-30d5c3011b7b",
                "controller": true,
                "blockOwnerDeletion": true
            }
        ],
        "managedFields": [
            {
                "manager": "machine-config-controller",
                "operation": "Update",
                "apiVersion": "machineconfiguration.openshift.io/v1",
                "time": "2022-02-17T14:29:28Z",
                "fieldsType": "FieldsV1",
                "fieldsV1": {
                    "f:metadata": {
                        "f:annotations": {
                            ".": {},
                            "f:machineconfiguration.openshift.io/generated-by-controller-version": {},
                            "f:machineconfiguration.openshift.io/release-image-version": {}
                        },
                        "f:ownerReferences": {
                            ".": {},
                            "k:{\"uid\":\"9eb65260-2906-47ff-a781-30d5c3011b7b\"}": {}
                        }
                    },
                    "f:spec": {
                        ".": {},
                        "f:config": {
                            ".": {},
                            "f:ignition": {
                                ".": {},
                                "f:version": {}
                            },
                            "f:passwd": {
                                ".": {},
                                "f:users": {}
                            },
                            "f:storage": {
                                ".": {},
                                "f:files": {}
                            },
                            "f:systemd": {
                                ".": {},
                                "f:units": {}
                            }
                        },
                        "f:extensions": {},
                        "f:fips": {},
                        "f:kernelArguments": {},
                        "f:kernelType": {},
                        "f:osImageURL": {}
                    }
                }
            }
        ]
    },
    "spec": {
        "osImageURL": "quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:1b5db764a79066c90a06f05efe2bc69ab974391edffbfe155f01996c133a848c",
        "config": {
            "ignition": {
                "version": "3.2.0"
            },
            "passwd": {
                "users": [
                    {
                        "name": "core",
                        "sshAuthorizedKeys": [
                            "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCbXCby9r69mn+lGn7/mjZRkr+ShGWmVcXT4pbwA8IJBkjJg/EtXFuL1VjP5QbbWvjakQ1ZpMEYkL4V1Gm1etzkoDuMV+VhvvL8uW59XezLH1My9RQ5vtXY7GpB3t4qbTX2AQ5abAlTAoRgOxr5mKT62m3uUpU6HBWkcqwhNGRNPQOhUBybbpxMyakJ/TyS5F7GOajsCWdhx3ErldXrtUgbArPwR16Nh0lA3jO81QJnKzbkcaVlCNd8A3to0Dx1g5cel2HDK37Ri6xYZssh1qGN+fecc7Gf4lqvp1gGMtKMyZw8t54/cJrSeVhzi+mq8aeTIaOAwpoa8C4H80HE35wog1tsS0WALlPdNZ8IyPZRfhH3iG12X0WttB5x2hHngQaYzSWzs1TvEGwrci1Y8EFE1xXG6ArAPG5Iy79tmXlOZM/R/D1K6oVRrVB6T4fWKtHFHJExlRI6HWT+Qxye96RPWxEdKEhWzOLRrBiWPSXYCtT4SCbBirP4C/htnDNcMGlT/HIETVf0R+ixjnsqeYYQn15cXvWSSDQ4LTnW9vBrDLsWVFV8hJ4outZ67Ztf/tBuGKfUFzLkTCFhWJER1bbH7Zhxn5xCplI4REr2+PKnhRaPCrz6W2TRO94pACkJG3M4eP3OyCbVfC1N1c0+MPwwJ0R7TAllli94t5jQthu8xw==\n"
                        ]
                    }
                ]
            },
            "storage": {
                "files": [
                    {
                        "contents": {
                            "source": "data:,%5Bkeyfile%5D%0Apath%3D%2Fetc%2FNetworkManager%2Fsystem-connections%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/NetworkManager/conf.d/20-keyfiles.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,"
                        },
                        "mode": 384,
                        "overwrite": true,
                        "path": "/etc/pki/ca-trust/source/anchors/openshift-config-user-ca-bundle.crt"
                    },
                    {
                        "contents": {
                            "source": "data:,%23%20This%20file%20is%20managed%20by%20machine-config-operator.%0A%23%20Suppress%20audit%20rules%20which%20always%20trigger%20for%20container%0A%23%20workloads%2C%20as%20they%20spam%20the%20audit%20log.%20%20Workloads%20are%20expected%0A%23%20to%20be%20dynamic%2C%20and%20the%20networking%20stack%20uses%20iptables.%0A-a%20exclude%2Calways%20-F%20msgtype%3DNETFILTER_CFG%0A%23%20The%20default%20bridged%20networking%20enables%20promiscuous%20on%20the%20veth%0A%23%20device.%20%20Ideally%2C%20we'd%20teach%20audit%20to%20ignore%20only%20veth%20devices%2C%0A%23%20since%20one%20might%20legitimately%20care%20about%20promiscuous%20on%20real%20physical%0A%23%20devices.%20%20But%20we%20can't%20currently%20differentiate.%0A-a%20exclude%2Calways%20-F%20msgtype%3DANOM_PROMISCUOUS%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/audit/rules.d/mco-audit-quiet-containers.rules"
                    },
                    {
                        "contents": {
                            "source": "data:,r%20%2Fetc%2Fkubernetes%2Fcni%2Fnet.d%2F80-openshift-network.conf%0Ar%20%2Fetc%2Fkubernetes%2Fcni%2Fnet.d%2F10-ovn-kubernetes.conf%0Ad%20%2Frun%2Fmultus%2Fcni%2Fnet.d%2F%200755%20root%20root%20-%20-%0AD%20%2Fvar%2Flib%2Fcni%2Fnetworks%2Fopenshift-sdn%2F%200755%20root%20root%20-%20-%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/tmpfiles.d/cleanup-cni.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/kubernetes/static-pod-resources/configmaps/cloud-config/ca-bundle.pem"
                    },
                    {
                        "contents": {
                            "source": "data:,%23!%2Fbin%2Fbash%0Aset%20-eux%0A%23%20This%20file%20is%20not%20needed%20anymore%20in%204.7%2B%2C%20but%20when%20rolling%20back%20to%204.6%0A%23%20the%20ovs%20pod%20needs%20it%20to%20know%20ovs%20is%20running%20on%20the%20host.%0Atouch%20%2Fvar%2Frun%2Fovs-config-executed%0ANM_CONN_PATH%3D%22%2Fetc%2FNetworkManager%2Fsystem-connections%22%0A%0AMANAGED_NM_CONN_SUFFIX%3D%22-slave-ovs-clone%22%0A%23%20Workaround%20to%20ensure%20OVS%20is%20installed%20due%20to%20bug%20in%20systemd%20Requires%3A%0A%23%20https%3A%2F%2Fbugzilla.redhat.com%2Fshow_bug.cgi%3Fid%3D1888017%0Acopy_nm_conn_files()%20%7B%0A%20%20local%20src_path%3D%22%24NM_CONN_PATH%22%0A%20%20local%20dst_path%3D%22%241%22%0A%20%20if%20%5B%20%22%24src_path%22%20%3D%20%22%24dst_path%22%20%5D%3B%20then%0A%20%20%20%20echo%20%22No%20need%20to%20copy%20configuration%20files%2C%20source%20and%20destination%20are%20the%20same%22%0A%20%20%20%20return%0A%20%20fi%0A%20%20if%20%5B%20-d%20%22%24src_path%22%20%5D%3B%20then%0A%20%20%20%20echo%20%22%24src_path%20exists%22%0A%20%20%20%20local%20files%3D(%22%24%7BMANAGED_NM_CONN_FILES%5B%40%5D%7D%22)%0A%20%20%20%20shopt%20-s%20nullglob%0A%20%20%20%20files%2B%3D(%24src_path%2F*%24%7BMANAGED_NM_CONN_SUFFIX%7D.nmconnection%20%24src_path%2F*%24%7BMANAGED_NM_CONN_SUFFIX%7D)%0A%20%20%20%20shopt%20-u%20nullglob%0A%20%20%20%20for%20file%20in%20%22%24%7Bfiles%5B%40%5D%7D%22%3B%20do%0A%20%20%20%20%20%20file%3D%22%24(basename%20%24file)%22%0A%20%20%20%20%20%20if%20%5B%20-f%20%22%24src_path%2F%24file%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20if%20%5B%20!%20-f%20%22%24dst_path%2F%24file%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20echo%20%22Copying%20configuration%20%24file%22%0A%20%20%20%20%20%20%20%20%20%20cp%20%22%24src_path%2F%24file%22%20%22%24dst_path%2F%24file%22%0A%20%20%20%20%20%20%20%20elif%20!%20cmp%20--silent%20%22%24src_path%2F%24file%22%20%22%24dst_path%2F%24file%22%3B%20then%0A%20%20%20%20%20%20%20%20%20%20echo%20%22Copying%20updated%20configuration%20%24file%22%0A%20%20%20%20%20%20%20%20%20%20cp%20-f%20%22%24src_path%2F%24file%22%20%22%24dst_path%2F%24file%22%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20echo%20%22Skipping%20%24file%20since%20it's%20equal%20at%20destination%22%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20echo%20%22Skipping%20%24file%20since%20it%20does%20not%20exist%20at%20source%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20done%0A%20%20fi%0A%7D%0A%0Aupdate_nm_conn_files()%20%7B%0A%20%20bridge_name%3D%24%7B1%7D%0A%20%20port_name%3D%24%7B2%7D%0A%20%20ovs_port%3D%22ovs-port-%24%7Bbridge_name%7D%22%0A%20%20ovs_interface%3D%22ovs-if-%24%7Bbridge_name%7D%22%0A%20%20default_port_name%3D%22ovs-port-%24%7Bport_name%7D%22%20%23%20ovs-port-phys0%0A%20%20bridge_interface_name%3D%22ovs-if-%24%7Bport_name%7D%22%20%23%20ovs-if-phys0%0A%23%20In%20RHEL7%20files%20in%20%2F%7Betc%2Crun%7D%2FNetworkManager%2Fsystem-connections%20end%20without%20the%20suffix%20'.nmconnection'%2C%20whereas%20in%20RHCOS%20they%20end%20with%20the%20suffix.%0A%20%20MANAGED_NM_CONN_FILES%3D(%24(echo%20%7B%22%24bridge_name%22%2C%22%24ovs_interface%22%2C%22%24ovs_port%22%2C%22%24bridge_interface_name%22%2C%22%24default_port_name%22%7D%20%7B%22%24bridge_name%22%2C%22%24ovs_interface%22%2C%22%24ovs_port%22%2C%22%24bridge_interface_name%22%2C%22%24default_port_name%22%7D.nmconnection))%0A%7D%0A%0A%23%20Used%20to%20remove%20files%20managed%20by%20configure-ovs%0Arm_nm_conn_files()%20%7B%0A%20%20local%20files%3D(%22%24%7BMANAGED_NM_CONN_FILES%5B%40%5D%7D%22)%0A%20%20shopt%20-s%20nullglob%0A%20%20files%2B%3D(%24%7BNM_CONN_PATH%7D%2F*%24%7BMANAGED_NM_CONN_SUFFIX%7D.nmconnection%20%24%7BNM_CONN_PATH%7D%2F*%24%7BMANAGED_NM_CONN_SUFFIX%7D)%0A%20%20shopt%20-u%20nullglob%0A%20%20for%20file%20in%20%22%24%7Bfiles%5B%40%5D%7D%22%3B%20do%0A%20%20%20%20file%3D%22%24(basename%20%24file)%22%0A%20%20%20%20file_path%3D%22%24%7BNM_CONN_PATH%7D%2F%24file%22%0A%20%20%20%20if%20%5B%20-f%20%22%24file_path%22%20%5D%3B%20then%0A%20%20%20%20%20%20rm%20-f%20%22%24file_path%22%0A%20%20%20%20%20%20echo%20%22Removed%20nmconnection%20file%20%24file_path%22%0A%20%20%20%20%20%20nm_conn_files_removed%3D1%0A%20%20%20%20fi%0A%20%20done%0A%7D%0A%0A%23%20Used%20to%20clone%20a%20slave%20connection%20by%20uuid%2C%20returns%20new%20uuid%0Aclone_slave_connection()%20%7B%0A%20%20local%20uuid%3D%22%241%22%0A%20%20local%20old_name%0A%20%20old_name%3D%22%24(nmcli%20-g%20connection.id%20connection%20show%20uuid%20%22%24uuid%22)%22%0A%20%20local%20new_name%3D%22%24%7Bold_name%7D%24%7BMANAGED_NM_CONN_SUFFIX%7D%22%0A%20%20if%20nmcli%20connection%20show%20id%20%22%24%7Bnew_name%7D%22%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20echo%20%22WARN%3A%20existing%20ovs%20slave%20%24%7Bnew_name%7D%20connection%20profile%20file%20found%2C%20overwriting...%22%20%3E%262%0A%20%20%20%20nmcli%20connection%20delete%20id%20%22%24%7Bnew_name%7D%22%20%26%3E%20%2Fdev%2Fnull%0A%20%20fi%0A%20%20nmcli%20connection%20clone%20%24uuid%20%22%24%7Bnew_name%7D%22%20%26%3E%20%2Fdev%2Fnull%0A%20%20nmcli%20-g%20connection.uuid%20connection%20show%20%22%24%7Bnew_name%7D%22%0A%7D%0A%0A%23%20Used%20to%20replace%20an%20old%20master%20connection%20uuid%20with%20a%20new%20one%20on%20all%20connections%0Areplace_connection_master()%20%7B%0A%20%20local%20old%3D%22%241%22%0A%20%20local%20new%3D%22%242%22%0A%20%20for%20conn_uuid%20in%20%24(nmcli%20-g%20UUID%20connection%20show)%20%3B%20do%0A%20%20%20%20if%20%5B%20%22%24(nmcli%20-g%20connection.master%20connection%20show%20uuid%20%22%24conn_uuid%22)%22%20!%3D%20%22%24old%22%20%5D%3B%20then%0A%20%20%20%20%20%20continue%0A%20%20%20%20fi%0A%0A%20%20%20%20%23%20make%20changes%20for%20slave%20profiles%20in%20a%20new%20clone%0A%20%20%20%20local%20new_uuid%0A%20%20%20%20new_uuid%3D%24(clone_slave_connection%20%24conn_uuid)%0A%0A%20%20%20%20nmcli%20conn%20mod%20uuid%20%24new_uuid%20connection.master%20%22%24new%22%0A%20%20%20%20nmcli%20conn%20mod%20%24new_uuid%20connection.autoconnect-priority%20100%0A%20%20%20%20echo%20%22Replaced%20master%20%24old%20with%20%24new%20for%20slave%20profile%20%24new_uuid%22%0A%20%20done%0A%7D%0A%0A%0A%23%20when%20creating%20the%20bridge%2C%20we%20use%20a%20value%20lower%20than%20NM's%20ethernet%20device%20default%20route%20metric%0A%23%20(we%20pick%2049%20to%20be%20lower%20than%20anything%20that%20NM%20chooses%20by%20default)%0ABRIDGE_METRIC%3D%2249%22%0A%23%20Given%20an%20interface%2C%20generates%20NM%20configuration%20to%20add%20to%20an%20OVS%20bridge%0Aconvert_to_bridge()%20%7B%0A%20%20iface%3D%24%7B1%7D%0A%20%20bridge_name%3D%24%7B2%7D%0A%20%20port_name%3D%24%7B3%7D%0A%20%20ovs_port%3D%22ovs-port-%24%7Bbridge_name%7D%22%0A%20%20ovs_interface%3D%22ovs-if-%24%7Bbridge_name%7D%22%0A%20%20default_port_name%3D%22ovs-port-%24%7Bport_name%7D%22%20%23%20ovs-port-phys0%0A%20%20bridge_interface_name%3D%22ovs-if-%24%7Bport_name%7D%22%20%23%20ovs-if-phys0%0A%0A%20%20if%20%5B%20%22%24iface%22%20%3D%20%22%24bridge_name%22%20%5D%3B%20then%0A%20%20%20%20%23%20handle%20vlans%20and%20bonds%20etc%20if%20they%20have%20already%20been%0A%20%20%20%20%23%20configured%20via%20nm%20key%20files%20and%20br-ex%20is%20already%20up%0A%20%20%20%20ifaces%3D%24(ovs-vsctl%20list-ifaces%20%24%7Biface%7D)%0A%20%20%20%20for%20intf%20in%20%24ifaces%3B%20do%20configure_driver_options%20%24intf%3B%20done%0A%20%20%20%20echo%20%22Networking%20already%20configured%20and%20up%20for%20%24%7Bbridge-name%7D!%22%0A%20%20%20%20return%0A%20%20fi%0A%0A%20%20if%20%5B%20-z%20%22%24iface%22%20%5D%3B%20then%0A%20%20%20%20echo%20%22ERROR%3A%20Unable%20to%20find%20default%20gateway%20interface%22%0A%20%20%20%20exit%201%0A%20%20fi%0A%20%20%23%20find%20the%20MAC%20from%20OVS%20config%20or%20the%20default%20interface%20to%20use%20for%20OVS%20internal%20port%0A%20%20%23%20this%20prevents%20us%20from%20getting%20a%20different%20DHCP%20lease%20and%20dropping%20connection%0A%20%20if%20!%20iface_mac%3D%24(%3C%22%2Fsys%2Fclass%2Fnet%2F%24%7Biface%7D%2Faddress%22)%3B%20then%0A%20%20%20%20echo%20%22Unable%20to%20determine%20default%20interface%20MAC%22%0A%20%20%20%20exit%201%0A%20%20fi%0A%0A%20%20echo%20%22MAC%20address%20found%20for%20iface%3A%20%24%7Biface%7D%3A%20%24%7Biface_mac%7D%22%0A%0A%20%20%23%20find%20MTU%20from%20original%20iface%0A%20%20iface_mtu%3D%24(ip%20link%20show%20%22%24iface%22%20%7C%20awk%20'%7Bprint%20%245%3B%20exit%7D')%0A%20%20if%20%5B%5B%20-z%20%22%24iface_mtu%22%20%5D%5D%3B%20then%0A%20%20%20%20echo%20%22Unable%20to%20determine%20default%20interface%20MTU%2C%20defaulting%20to%201500%22%0A%20%20%20%20iface_mtu%3D1500%0A%20%20else%0A%20%20%20%20echo%20%22MTU%20found%20for%20iface%3A%20%24%7Biface%7D%3A%20%24%7Biface_mtu%7D%22%0A%20%20fi%0A%0A%20%20%23%20store%20old%20conn%20for%20later%0A%20%20old_conn%3D%24(nmcli%20--fields%20UUID%2CDEVICE%20conn%20show%20--active%20%7C%20awk%20%22%2F%5Cs%24%7Biface%7D%5Cs*%5C%24%2F%20%7Bprint%20%5C%241%7D%22)%0A%0A%20%20extra_brex_args%3D%22%22%0A%20%20%23%20check%20for%20dhcp%20client%20ids%0A%20%20dhcp_client_id%3D%24(nmcli%20--get-values%20ipv4.dhcp-client-id%20conn%20show%20%24%7Bold_conn%7D)%0A%20%20if%20%5B%20-n%20%22%24dhcp_client_id%22%20%5D%3B%20then%0A%20%20%20%20extra_brex_args%2B%3D%22ipv4.dhcp-client-id%20%24%7Bdhcp_client_id%7D%20%22%0A%20%20fi%0A%0A%20%20dhcp6_client_id%3D%24(nmcli%20--get-values%20ipv6.dhcp-duid%20conn%20show%20%24%7Bold_conn%7D)%0A%20%20if%20%5B%20-n%20%22%24dhcp6_client_id%22%20%5D%3B%20then%0A%20%20%20%20extra_brex_args%2B%3D%22ipv6.dhcp-duid%20%24%7Bdhcp6_client_id%7D%20%22%0A%20%20fi%0A%0A%20%20ipv6_addr_gen_mode%3D%24(nmcli%20--get-values%20ipv6.addr-gen-mode%20conn%20show%20%24%7Bold_conn%7D)%0A%20%20if%20%5B%20-n%20%22%24ipv6_addr_gen_mode%22%20%5D%3B%20then%0A%20%20%20%20extra_brex_args%2B%3D%22ipv6.addr-gen-mode%20%24%7Bipv6_addr_gen_mode%7D%20%22%0A%20%20fi%0A%0A%20%20%23%20create%20bridge%0A%20%20if%20!%20nmcli%20connection%20show%20%22%24bridge_name%22%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20ovs-vsctl%20--timeout%3D30%20--if-exists%20del-br%20%22%24bridge_name%22%0A%20%20%20%20nmcli%20c%20add%20type%20ovs-bridge%20%5C%0A%20%20%20%20%20%20%20%20con-name%20%22%24bridge_name%22%20%5C%0A%20%20%20%20%20%20%20%20conn.interface%20%22%24bridge_name%22%20%5C%0A%20%20%20%20%20%20%20%20802-3-ethernet.mtu%20%24%7Biface_mtu%7D%20%5C%0A%20%20%20%20%20%20%20%20ipv4.route-metric%20%22%24BRIDGE_METRIC%22%20%5C%0A%20%20%20%20%20%20%20%20ipv6.route-metric%20%22%24BRIDGE_METRIC%22%20%5C%0A%20%20%20%20%20%20%20%20%24%7Bextra_brex_args%7D%0A%20%20fi%0A%0A%20%20%23%20find%20default%20port%20to%20add%20to%20bridge%0A%20%20if%20!%20nmcli%20connection%20show%20%22%24default_port_name%22%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20ovs-vsctl%20--timeout%3D30%20--if-exists%20del-port%20%22%24bridge_name%22%20%24%7Biface%7D%0A%20%20%20%20nmcli%20c%20add%20type%20ovs-port%20conn.interface%20%24%7Biface%7D%20master%20%22%24bridge_name%22%20con-name%20%22%24default_port_name%22%0A%20%20fi%0A%0A%20%20if%20!%20nmcli%20connection%20show%20%22%24ovs_port%22%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20ovs-vsctl%20--timeout%3D30%20--if-exists%20del-port%20%22%24bridge_name%22%20%22%24bridge_name%22%0A%20%20%20%20nmcli%20c%20add%20type%20ovs-port%20conn.interface%20%22%24bridge_name%22%20master%20%22%24bridge_name%22%20con-name%20%22%24ovs_port%22%0A%20%20fi%0A%0A%20%20extra_phys_args%3D()%0A%20%20%23%20check%20if%20this%20interface%20is%20a%20vlan%2C%20bond%2C%20team%2C%20or%20ethernet%20type%0A%20%20if%20%5B%20%24(nmcli%20--get-values%20connection.type%20conn%20show%20%24%7Bold_conn%7D)%20%3D%3D%20%22vlan%22%20%5D%3B%20then%0A%20%20%20%20iface_type%3Dvlan%0A%20%20%20%20vlan_id%3D%24(nmcli%20--get-values%20vlan.id%20conn%20show%20%24%7Bold_conn%7D)%0A%20%20%20%20if%20%5B%20-z%20%22%24vlan_id%22%20%5D%3B%20then%0A%20%20%20%20%20%20echo%20%22ERROR%3A%20unable%20to%20determine%20vlan_id%20for%20vlan%20connection%3A%20%24%7Bold_conn%7D%22%0A%20%20%20%20%20%20exit%201%0A%20%20%20%20fi%0A%20%20%20%20vlan_parent%3D%24(nmcli%20--get-values%20vlan.parent%20conn%20show%20%24%7Bold_conn%7D)%0A%20%20%20%20if%20%5B%20-z%20%22%24vlan_parent%22%20%5D%3B%20then%0A%20%20%20%20%20%20echo%20%22ERROR%3A%20unable%20to%20determine%20vlan_parent%20for%20vlan%20connection%3A%20%24%7Bold_conn%7D%22%0A%20%20%20%20%20%20exit%201%0A%20%20%20%20fi%0A%20%20%20%20extra_phys_args%3D(%20dev%20%22%24%7Bvlan_parent%7D%22%20id%20%22%24%7Bvlan_id%7D%22%20)%0A%20%20elif%20%5B%20%24(nmcli%20--get-values%20connection.type%20conn%20show%20%24%7Bold_conn%7D)%20%3D%3D%20%22bond%22%20%5D%3B%20then%0A%20%20%20%20iface_type%3Dbond%0A%20%20%20%20%23%20check%20bond%20options%0A%20%20%20%20bond_opts%3D%24(nmcli%20--get-values%20bond.options%20conn%20show%20%24%7Bold_conn%7D)%0A%20%20%20%20if%20%5B%20-n%20%22%24bond_opts%22%20%5D%3B%20then%0A%20%20%20%20%20%20extra_phys_args%2B%3D(%20bond.options%20%22%24%7Bbond_opts%7D%22%20)%0A%20%20%20%20fi%0A%20%20elif%20%5B%20%24(nmcli%20--get-values%20connection.type%20conn%20show%20%24%7Bold_conn%7D)%20%3D%3D%20%22team%22%20%5D%3B%20then%0A%20%20%20%20iface_type%3Dteam%0A%20%20%20%20%23%20check%20team%20config%20options%0A%20%20%20%20team_config_opts%3D%24(nmcli%20--get-values%20team.config%20-e%20no%20conn%20show%20%24%7Bold_conn%7D)%0A%20%20%20%20if%20%5B%20-n%20%22%24team_config_opts%22%20%5D%3B%20then%0A%20%20%20%20%20%20%23%20team.config%20is%20json%2C%20remove%20spaces%20to%20avoid%20problems%20later%20on%0A%20%20%20%20%20%20extra_phys_args%2B%3D(%20team.config%20%22%24%7Bteam_config_opts%2F%2F%5B%5B%3Aspace%3A%5D%5D%2F%7D%22%20)%0A%20%20%20%20fi%0A%20%20else%0A%20%20%20%20iface_type%3D802-3-ethernet%0A%20%20fi%0A%0A%20%20%23%20use%20%24%7Bextra_phys_args%5B%40%5D%2B%22%24%7Bextra_phys_args%5B%40%5D%7D%22%7D%20instead%20of%20%24%7Bextra_phys_args%5B%40%5D%7D%20to%20be%20compatible%20with%20bash%204.2%20in%20RHEL7.9%0A%20%20if%20!%20nmcli%20connection%20show%20%22%24bridge_interface_name%22%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20ovs-vsctl%20--timeout%3D30%20--if-exists%20destroy%20interface%20%24%7Biface%7D%0A%20%20%20%20nmcli%20c%20add%20type%20%24%7Biface_type%7D%20conn.interface%20%24%7Biface%7D%20master%20%22%24default_port_name%22%20con-name%20%22%24bridge_interface_name%22%20%5C%0A%20%20%20%20connection.autoconnect-priority%20100%20802-3-ethernet.mtu%20%24%7Biface_mtu%7D%20%24%7Bextra_phys_args%5B%40%5D%2B%22%24%7Bextra_phys_args%5B%40%5D%7D%22%7D%0A%20%20fi%0A%0A%20%20%23%20Get%20the%20new%20connection%20uuid%0A%20%20new_conn%3D%24(nmcli%20-g%20connection.uuid%20conn%20show%20%22%24bridge_interface_name%22)%0A%0A%20%20%23%20Update%20connections%20with%20master%20property%20set%20to%20use%20the%20new%20connection%0A%20%20replace_connection_master%20%24old_conn%20%24new_conn%0A%20%20replace_connection_master%20%24iface%20%24new_conn%0A%0A%20%20if%20!%20nmcli%20connection%20show%20%22%24ovs_interface%22%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20ovs-vsctl%20--timeout%3D30%20--if-exists%20destroy%20interface%20%22%24bridge_name%22%0A%20%20%20%20if%20nmcli%20--fields%20ipv4.method%2Cipv6.method%20conn%20show%20%24old_conn%20%7C%20grep%20manual%3B%20then%0A%20%20%20%20%20%20echo%20%22Static%20IP%20addressing%20detected%20on%20default%20gateway%20connection%3A%20%24%7Bold_conn%7D%22%0A%20%20%20%20%20%20%23%20find%20and%20copy%20the%20old%20connection%20to%20get%20the%20address%20settings%0A%20%20%20%20%20%20if%20egrep%20-l%20%22%5Euuid%3D%24old_conn%22%20%24%7BNM_CONN_PATH%7D%2F*%3B%20then%0A%20%20%20%20%20%20%20%20old_conn_file%3D%24(egrep%20-l%20%22%5Euuid%3D%24old_conn%22%20%24%7BNM_CONN_PATH%7D%2F*)%0A%20%20%20%20%20%20%20%20cloned%3Dfalse%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20echo%20%22WARN%3A%20unable%20to%20find%20NM%20configuration%20file%20for%20conn%3A%20%24%7Bold_conn%7D.%20Attempting%20to%20clone%20conn%22%0A%20%20%20%20%20%20%20%20nmcli%20conn%20clone%20%24%7Bold_conn%7D%20%24%7Bold_conn%7D-clone%0A%20%20%20%20%20%20%20%20shopt%20-s%20nullglob%0A%20%20%20%20%20%20%20%20old_conn_files%3D(%24%7BNM_CONN_PATH%7D%2F%22%24%7Bold_conn%7D%22-clone*)%0A%20%20%20%20%20%20%20%20shopt%20-u%20nullglob%0A%20%20%20%20%20%20%20%20if%20%5B%20%24%7B%23old_conn_files%5B%40%5D%7D%20-ne%201%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20echo%20%22ERROR%3A%20unable%20to%20locate%20cloned%20conn%20file%20for%20%24%7Bold_conn%7D-clone%22%0A%20%20%20%20%20%20%20%20%20%20exit%201%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20old_conn_file%3D%22%24%7Bold_conn_files%5B0%5D%7D%22%0A%20%20%20%20%20%20%20%20cloned%3Dtrue%0A%20%20%20%20%20%20%20%20echo%20%22Successfully%20cloned%20conn%20to%20%24%7Bold_conn_file%7D%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20%20%20echo%20%22old%20connection%20file%20found%20at%3A%20%24%7Bold_conn_file%7D%22%0A%20%20%20%20%20%20old_basename%3D%24(basename%20%22%24%7Bold_conn_file%7D%22%20.nmconnection)%0A%20%20%20%20%20%20new_conn_file%3D%22%24%7Bold_conn_file%2F%24%7BNM_CONN_PATH%7D%5C%2F%24old_basename%2F%24%7BNM_CONN_PATH%7D%2F%24ovs_interface%7D%22%0A%20%20%20%20%20%20if%20%5B%20-f%20%22%24new_conn_file%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20echo%20%22WARN%3A%20existing%20%24bridge_name%20interface%20file%20found%3A%20%24new_conn_file%2C%20which%20is%20not%20loaded%20in%20NetworkManager...overwriting%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20%20%20cp%20-f%20%22%24%7Bold_conn_file%7D%22%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20restorecon%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20if%20%24cloned%3B%20then%0A%20%20%20%20%20%20%20%20nmcli%20conn%20delete%20%24%7Bold_conn%7D-clone%0A%20%20%20%20%20%20%20%20rm%20-f%20%22%24%7Bold_conn_file%7D%22%0A%20%20%20%20%20%20fi%0A%20%20%20%20%20%20ovs_port_conn%3D%24(nmcli%20--fields%20connection.uuid%20conn%20show%20%22%24ovs_port%22%20%7C%20awk%20'%7Bprint%20%242%7D')%0A%20%20%20%20%20%20br_iface_uuid%3D%24(cat%20%2Fproc%2Fsys%2Fkernel%2Frandom%2Fuuid)%0A%20%20%20%20%20%20%23%20modify%20file%20to%20work%20with%20OVS%20and%20have%20unique%20settings%0A%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bconnection%5C%5D%24%2F%2C%2F%5E%5C%5B%2F%20s%2F%5Euuid%3D.*%24%2Fuuid%3D'%22%24br_iface_uuid%22'%2F'%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20sed%20-i%20'%2F%5Emulti-connect%3D.*%24%2Fd'%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bconnection%5C%5D%24%2F%2C%2F%5E%5C%5B%2F%20s%2F%5Etype%3D.*%24%2Ftype%3Dovs-interface%2F'%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bconnection%5C%5D%24%2F%2C%2F%5E%5C%5B%2F%20s%2F%5Eid%3D.*%24%2Fid%3D'%22%24ovs_interface%22'%2F'%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bconnection%5C%5D%24%2Fa%20slave-type%3Dovs-port'%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bconnection%5C%5D%24%2Fa%20master%3D'%22%24ovs_port_conn%22%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20if%20grep%20'interface-name%3D'%20%24%7Bnew_conn_file%7D%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bconnection%5C%5D%24%2F%2C%2F%5E%5C%5B%2F%20s%2F%5Einterface-name%3D.*%24%2Finterface-name%3D'%22%24bridge_name%22'%2F'%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bconnection%5C%5D%24%2Fa%20interface-name%3D'%22%24bridge_name%22%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20fi%0A%20%20%20%20%20%20if%20!%20grep%20'cloned-mac-address%3D'%20%24%7Bnew_conn_file%7D%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bethernet%5C%5D%24%2Fa%20cloned-mac-address%3D'%22%24iface_mac%22%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bethernet%5C%5D%24%2F%2C%2F%5E%5C%5B%2F%20s%2F%5Ecloned-mac-address%3D.*%24%2Fcloned-mac-address%3D'%22%24iface_mac%22'%2F'%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20fi%0A%20%20%20%20%20%20if%20grep%20'mtu%3D'%20%24%7Bnew_conn_file%7D%20%26%3E%20%2Fdev%2Fnull%3B%20then%0A%20%20%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bethernet%5C%5D%24%2F%2C%2F%5E%5C%5B%2F%20s%2F%5Emtu%3D.*%24%2Fmtu%3D'%22%24iface_mtu%22'%2F'%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20sed%20-i%20'%2F%5E%5C%5Bethernet%5C%5D%24%2Fa%20mtu%3D'%22%24iface_mtu%22%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20fi%0A%20%20%20%20%20%20cat%20%3C%3CEOF%20%3E%3E%20%24%7Bnew_conn_file%7D%0A%5Bovs-interface%5D%0Atype%3Dinternal%0AEOF%0A%20%20%20%20%20%20nmcli%20c%20load%20%24%7Bnew_conn_file%7D%0A%20%20%20%20%20%20echo%20%22Loaded%20new%20%24ovs_interface%20connection%20file%3A%20%24%7Bnew_conn_file%7D%22%0A%20%20%20%20else%0A%20%20%20%20%20%20extra_if_brex_args%3D%22%22%0A%20%20%20%20%20%20%23%20check%20if%20interface%20had%20ipv4%2Fipv6%20addresses%20assigned%0A%20%20%20%20%20%20num_ipv4_addrs%3D%24(ip%20-j%20a%20show%20dev%20%24%7Biface%7D%20%7C%20jq%20%22.%5B0%5D.addr_info%20%7C%20map(.%20%7C%20select(.family%20%3D%3D%20%5C%22inet%5C%22))%20%7C%20length%22)%0A%20%20%20%20%20%20if%20%5B%20%22%24num_ipv4_addrs%22%20-gt%200%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20extra_if_brex_args%2B%3D%22ipv4.may-fail%20no%20%22%0A%20%20%20%20%20%20fi%0A%0A%20%20%20%20%20%20%23%20IPV6%20should%20have%20at%20least%20a%20link%20local%20address.%20Check%20for%20more%20than%201%20to%20see%20if%20there%20is%20an%0A%20%20%20%20%20%20%23%20assigned%20address.%0A%20%20%20%20%20%20num_ip6_addrs%3D%24(ip%20-j%20a%20show%20dev%20%24%7Biface%7D%20%7C%20jq%20%22.%5B0%5D.addr_info%20%7C%20map(.%20%7C%20select(.family%20%3D%3D%20%5C%22inet6%5C%22%20and%20.scope%20!%3D%20%5C%22link%5C%22))%20%7C%20length%22)%0A%20%20%20%20%20%20if%20%5B%20%22%24num_ip6_addrs%22%20-gt%200%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20extra_if_brex_args%2B%3D%22ipv6.may-fail%20no%20%22%0A%20%20%20%20%20%20fi%0A%0A%20%20%20%20%20%20nmcli%20c%20add%20type%20ovs-interface%20slave-type%20ovs-port%20conn.interface%20%22%24bridge_name%22%20master%20%22%24ovs_port%22%20con-name%20%5C%0A%20%20%20%20%20%20%20%20%22%24ovs_interface%22%20802-3-ethernet.mtu%20%24%7Biface_mtu%7D%20802-3-ethernet.cloned-mac-address%20%24%7Biface_mac%7D%20%5C%0A%20%20%20%20%20%20%20%20ipv4.route-metric%20%22%24BRIDGE_METRIC%22%20ipv6.route-metric%20%22%24BRIDGE_METRIC%22%20%24%7Bextra_if_brex_args%7D%0A%20%20%20%20fi%0A%20%20fi%0A%0A%20%20configure_driver_options%20%22%24%7Biface%7D%22%0A%20%20update_nm_conn_files%20%22%24bridge_name%22%20%22%24port_name%22%0A%7D%0A%0A%23%20Used%20to%20remove%20a%20bridge%0Aremove_ovn_bridges()%20%7B%0A%20%20bridge_name%3D%24%7B1%7D%0A%20%20port_name%3D%24%7B2%7D%0A%0A%20%20%23%20Reload%20configuration%2C%20after%20reload%20the%20preferred%20connection%20profile%0A%20%20%23%20should%20be%20auto-activated%0A%20%20update_nm_conn_files%20%24%7Bbridge_name%7D%20%24%7Bport_name%7D%0A%20%20rm_nm_conn_files%0A%0A%20%20%23%20NetworkManager%20will%20not%20remove%20%24%7Bbridge_name%7D%20if%20it%20has%20the%20patch%20port%20created%20by%20ovn-kubernetes%0A%20%20%23%20so%20remove%20explicitly%0A%20%20ovs-vsctl%20--timeout%3D30%20--if-exists%20del-br%20%24%7Bbridge_name%7D%0A%7D%0A%0A%23%20Removes%20any%20previous%20ovs%20configuration%0Aremove_all_ovn_bridges()%20%7B%0A%20%20echo%20%22Reverting%20any%20previous%20OVS%20configuration%22%0A%20%20%0A%20%20remove_ovn_bridges%20br-ex%20phys0%0A%20%20if%20%5B%20-d%20%22%2Fsys%2Fclass%2Fnet%2Fbr-ex1%22%20%5D%3B%20then%0A%20%20%20%20remove_ovn_bridges%20br-ex1%20phys1%0A%20%20fi%0A%20%20%0A%20%20echo%20%22OVS%20configuration%20successfully%20reverted%22%0A%7D%0A%0A%23%20Reloads%20NetworkManager%0Areload_nm()%20%7B%0A%20%20echo%20%22Reloading%20NetworkManager...%22%0A%0A%20%20%23%20set%20network%20off%2C%20so%20that%20auto-connect%20priority%20is%20evaluated%20when%20turning%0A%20%20%23%20it%20back%20on%0A%20%20nmcli%20network%20off%0A%20%20%0A%20%20%23%20restart%20NetworkManager%20to%20reload%20profiles%2C%20including%20generating%0A%20%20%23%20transient%20profiles%20for%20devices%20that%20don't%20have%20any%0A%20%20systemctl%20restart%20NetworkManager%0A%0A%20%20%23%20turn%20network%20back%20on%20triggering%20auto-connects%20%0A%20%20nmcli%20network%20on%0A%0A%20%20%23%20Wait%20until%20all%20profiles%20auto-connect%0A%20%20if%20nm-online%20-s%20-t%2060%3B%20then%0A%20%20%20%20echo%20%22NetworkManager%20has%20activated%20all%20suitable%20profiles%20after%20reload%22%0A%20%20else%0A%20%20%20%20echo%20%22NetworkManager%20has%20not%20activated%20all%20suitable%20profiles%20after%20reload%22%0A%20%20fi%0A%0A%20%20%23%20Check%20if%20we%20have%20any%20type%20of%20connectivity%0A%20%20if%20nm-online%20-t%200%3B%20then%0A%20%20%20%20echo%20%22NetworkManager%20has%20connectivity%20after%20reload%22%0A%20%20else%0A%20%20%20%20echo%20%22NetworkManager%20does%20not%20have%20connectivity%20after%20reload%22%0A%20%20fi%0A%7D%0A%0A%23%20Removes%20all%20configuration%20and%20reloads%20NM%20if%20necessary%0Arollback_nm()%20%7B%0A%20%20%23%20This%20will%20be%20set%20to%201%20if%20remove_all_ovn_bridges%20actually%20changes%20anything%0A%20%20nm_conn_files_removed%3D0%0A%0A%20%20%23%20Revert%20changes%20made%20by%20%2Fusr%2Flocal%2Fbin%2Fconfigure-ovs.sh%20during%20SDN%20migration.%0A%20%20remove_all_ovn_bridges%0A%20%20%0A%20%20%23%20Reload%20only%20if%20we%20removed%20connection%20profiles%0A%20%20if%20%5B%20%24nm_conn_files_removed%20-eq%201%20%5D%3B%20then%0A%20%20%20%20echo%20%22OVS%20configuration%20was%20cleaned%20up%2C%20will%20reload%20NetworkManager%22%0A%20%20%20%20reload_nm%0A%20%20fi%0A%7D%0A%0A%23%20Activates%20a%20NM%20connection%20profile%0Aactivate_nm_conn()%20%7B%0A%20%20local%20conn%3D%22%241%22%0A%20%20for%20i%20in%20%7B1..10%7D%3B%20do%0A%20%20%20%20echo%20%22Attempt%20%24i%20to%20bring%20up%20connection%20%24conn%22%0A%20%20%20%20nmcli%20conn%20up%20%22%24conn%22%20%26%26%20s%3D0%20%26%26%20break%20%7C%7C%20s%3D%24%3F%0A%20%20%20%20sleep%205%0A%20%20done%0A%20%20if%20%5B%20%24s%20-eq%200%20%5D%3B%20then%0A%20%20%20%20echo%20%22Brought%20up%20connection%20%24conn%20successfully%22%0A%20%20else%0A%20%20%20%20echo%20%22ERROR%3A%20Cannot%20bring%20up%20connection%20%24conn%20after%20%24i%20attempts%22%0A%20%20fi%0A%20%20return%20%24s%0A%7D%0A%0A%23%20Used%20to%20print%20network%20state%0Aprint_state()%20%7B%0A%20%20echo%20%22Current%20device%2C%20connection%2C%20interface%20and%20routing%20state%3A%22%0A%20%20nmcli%20-g%20all%20device%20%7C%20grep%20-v%20unmanaged%0A%20%20nmcli%20-g%20all%20connection%0A%20%20ip%20-d%20address%20show%0A%20%20ip%20route%20show%0A%20%20ip%20-6%20route%20show%0A%7D%0A%0A%23%20Setup%20an%20exit%20trap%20to%20rollback%20on%20error%0Ahandle_exit()%20%7B%0A%20%20e%3D%24%3F%0A%20%20%5B%20%24e%20-eq%200%20%5D%20%26%26%20print_state%20%26%26%20exit%200%0A%0A%20%20echo%20%22ERROR%3A%20configure-ovs%20exited%20with%20error%3A%20%24e%22%0A%20%20print_state%0A%0A%20%20%23%20copy%20configuration%20to%20tmp%0A%20%20dir%3D%24(mktemp%20-d%20-t%20%22configure-ovs-%24(date%20%2B%25Y-%25m-%25d-%25H-%25M-%25S)-XXXXXXXXXX%22)%0A%20%20update_nm_conn_files%20br-ex%20phys0%0A%20%20copy_nm_conn_files%20%22%24dir%22%0A%20%20update_nm_conn_files%20br-ex1%20phys1%0A%20%20copy_nm_conn_files%20%22%24dir%22%0A%20%20echo%20%22Copied%20OVS%20configuration%20to%20%24dir%20for%20troubleshooting%22%0A%0A%20%20%23%20attempt%20to%20restore%20the%20previous%20network%20state%0A%20%20echo%20%22Attempting%20to%20restore%20previous%20configuration...%22%0A%20%20rollback_nm%0A%20%20print_state%0A%0A%20%20exit%20%24e%0A%7D%0Atrap%20%22handle_exit%22%20EXIT%0A%0A%23%20Clean%20up%20old%20config%20on%20behalf%20of%20mtu-migration%0Aif%20%5B%20!%20-f%20%2Fetc%2Fcno%2Fmtu-migration%2Fconfig%20%5D%3B%20then%0A%20%20echo%20%22Cleaning%20up%20left%20over%20mtu%20migration%20configuration%22%0A%20%20rm%20-rf%20%2Fetc%2Fcno%2Fmtu-migration%0Afi%0A%0Aif%20!%20rpm%20-qa%20%7C%20grep%20-q%20openvswitch%3B%20then%0A%20%20echo%20%22Warning%3A%20Openvswitch%20package%20is%20not%20installed!%22%0A%20%20exit%201%0Afi%0A%0A%23%20print%20initial%20state%0Aprint_state%0A%0Aif%20%5B%20%22%241%22%20%3D%3D%20%22OVNKubernetes%22%20%5D%3B%20then%0A%20%20%23%20Configures%20NICs%20onto%20OVS%20bridge%20%22br-ex%22%0A%20%20%23%20Configuration%20is%20either%20auto-detected%20or%20provided%20through%20a%20config%20file%20written%20already%20in%20Network%20Manager%0A%20%20%23%20key%20files%20under%20%2Fetc%2FNetworkManager%2Fsystem-connections%2F%0A%20%20%23%20Managing%20key%20files%20is%20outside%20of%20the%20scope%20of%20this%20script%0A%0A%20%20%23%20if%20the%20interface%20is%20of%20type%20vmxnet3%20add%20multicast%20capability%20for%20that%20driver%0A%20%20%23%20REMOVEME%3A%20Once%20BZ%3A1854355%20is%20fixed%2C%20this%20needs%20to%20get%20removed.%0A%20%20function%20configure_driver_options%20%7B%0A%20%20%20%20intf%3D%241%0A%20%20%20%20if%20%5B%20!%20-f%20%22%2Fsys%2Fclass%2Fnet%2F%24%7Bintf%7D%2Fdevice%2Fuevent%22%20%5D%3B%20then%0A%20%20%20%20%20%20echo%20%22Device%20file%20doesn't%20exist%2C%20skipping%20setting%20multicast%20mode%22%0A%20%20%20%20else%0A%20%20%20%20%20%20driver%3D%24(cat%20%22%2Fsys%2Fclass%2Fnet%2F%24%7Bintf%7D%2Fdevice%2Fuevent%22%20%7C%20grep%20DRIVER%20%7C%20awk%20-F%20%22%3D%22%20'%7Bprint%20%242%7D')%0A%20%20%20%20%20%20echo%20%22Driver%20name%20is%22%20%24driver%0A%20%20%20%20%20%20if%20%5B%20%22%24driver%22%20%3D%20%22vmxnet3%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20ifconfig%20%22%24intf%22%20allmulti%0A%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%20%20%7D%0A%0A%20%20%23%20on%20every%20boot%20we%20rollback%20and%20generate%20the%20configuration%20again%2C%20to%20take%0A%20%20%23%20in%20any%20changes%20that%20have%20possibly%20been%20applied%20in%20the%20standard%0A%20%20%23%20configuration%20sources%0A%20%20if%20%5B%20!%20-f%20%2Frun%2Fconfigure-ovs-boot-done%20%5D%3B%20then%0A%20%20%20%20echo%20%22Running%20on%20boot%2C%20restoring%20previous%20configuration%20before%20proceeding...%22%0A%20%20%20%20rollback_nm%0A%20%20%20%20print_state%0A%20%20fi%0A%20%20touch%20%2Frun%2Fconfigure-ovs-boot-done%0A%0A%20%20iface%3D%22%22%0A%20%20counter%3D0%0A%20%20%23%20find%20default%20interface%0A%20%20while%20%5B%20%24counter%20-lt%2012%20%5D%3B%20do%0A%20%20%20%20%23%20check%20ipv4%0A%20%20%20%20iface%3D%24(ip%20route%20show%20default%20%7C%20awk%20'%7B%20if%20(%244%20%3D%3D%20%22dev%22)%20%7B%20print%20%245%3B%20exit%20%7D%20%7D')%0A%20%20%20%20if%20%5B%5B%20-n%20%22%24iface%22%20%5D%5D%3B%20then%0A%20%20%20%20%20%20echo%20%22IPv4%20Default%20gateway%20interface%20found%3A%20%24%7Biface%7D%22%0A%20%20%20%20%20%20break%0A%20%20%20%20fi%0A%20%20%20%20%23%20check%20ipv6%0A%20%20%20%20iface%3D%24(ip%20-6%20route%20show%20default%20%7C%20awk%20'%7B%20if%20(%244%20%3D%3D%20%22dev%22)%20%7B%20print%20%245%3B%20exit%20%7D%20%7D')%0A%20%20%20%20if%20%5B%5B%20-n%20%22%24iface%22%20%5D%5D%3B%20then%0A%20%20%20%20%20%20echo%20%22IPv6%20Default%20gateway%20interface%20found%3A%20%24%7Biface%7D%22%0A%20%20%20%20%20%20break%0A%20%20%20%20fi%0A%20%20%20%20counter%3D%24((counter%2B1))%0A%20%20%20%20echo%20%22No%20default%20route%20found%20on%20attempt%3A%20%24%7Bcounter%7D%22%0A%20%20%20%20sleep%205%0A%20%20done%0A%0A%20%20extra_bridge_file%3D'%2Fetc%2Fovnk%2Fextra_bridge'%0A%0A%20%20if%20%5B%20%22%24iface%22%20!%3D%20%22br-ex%22%20%5D%3B%20then%0A%20%20%20%20%23%20Default%20gateway%20is%20not%20br-ex.%0A%20%20%20%20%23%20Some%20deployments%20use%20a%20temporary%20solution%20where%20br-ex%20is%20moved%20out%20from%20the%20default%20gateway%20interface%0A%20%20%20%20%23%20and%20bound%20to%20a%20different%20nic%20(https%3A%2F%2Fgithub.com%2Ftrozet%2Fopenshift-ovn-migration).%0A%20%20%20%20%23%20This%20is%20now%20supported%20through%20an%20extra%20bridge%20if%20requested.%20If%20that%20is%20the%20case%2C%20we%20rollback.%0A%20%20%20%20%23%20We%20also%20rollback%20if%20it%20looks%20like%20we%20need%20to%20configure%20things%2C%20just%20in%20case%20there%20are%20any%20leftovers%0A%20%20%20%20%23%20from%20previous%20attempts.%0A%20%20%20%20if%20%5B%20-f%20%22%24extra_bridge_file%22%20%5D%20%7C%7C%20%5B%20-z%20%22%24(nmcli%20connection%20show%20--active%20br-ex%202%3E%20%2Fdev%2Fnull)%22%20%5D%3B%20then%0A%20%20%20%20%20%20echo%20%22Bridge%20br-ex%20is%20not%20active%2C%20restoring%20previous%20configuration%20before%20proceeding...%22%0A%20%20%20%20%20%20rollback_nm%0A%20%20%20%20%20%20print_state%0A%20%20%20%20fi%0A%20%20fi%0A%0A%20%20convert_to_bridge%20%22%24iface%22%20%22br-ex%22%20%22phys0%22%0A%0A%20%20%23%20Check%20if%20we%20need%20to%20configure%20the%20second%20bridge%0A%20%20if%20%5B%20-f%20%22%24extra_bridge_file%22%20%5D%20%26%26%20(!%20nmcli%20connection%20show%20br-ex1%20%26%3E%20%2Fdev%2Fnull%20%7C%7C%20!%20nmcli%20connection%20show%20ovs-if-phys1%20%26%3E%20%2Fdev%2Fnull)%3B%20then%0A%20%20%20%20interface%3D%24(head%20-n%201%20%24extra_bridge_file)%0A%20%20%20%20convert_to_bridge%20%22%24interface%22%20%22br-ex1%22%20%22phys1%22%0A%20%20fi%0A%0A%20%20%23%20Check%20if%20we%20need%20to%20remove%20the%20second%20bridge%0A%20%20if%20%5B%20!%20-f%20%22%24extra_bridge_file%22%20%5D%20%26%26%20(nmcli%20connection%20show%20br-ex1%20%26%3E%20%2Fdev%2Fnull%20%7C%7C%20nmcli%20connection%20show%20ovs-if-phys1%20%26%3E%20%2Fdev%2Fnull)%3B%20then%0A%20%20%20%20update_nm_conn_files%20br-ex1%20phys1%0A%20%20%20%20rm_nm_conn_files%0A%20%20fi%0A%0A%20%20%23%20Remove%20bridges%20created%20by%20openshift-sdn%0A%20%20ovs-vsctl%20--timeout%3D30%20--if-exists%20del-br%20br0%0A%20%20%0A%20%20%23%20Recycle%20NM%20connections%0A%20%20reload_nm%0A%0A%20%20%23%20Make%20sure%20everything%20is%20activated%0A%20%20activate_nm_conn%20ovs-if-phys0%0A%20%20activate_nm_conn%20ovs-if-br-ex%0A%20%20if%20%5B%20-f%20%22%24extra_bridge_file%22%20%5D%3B%20then%0A%20%20%20%20activate_nm_conn%20ovs-if-phys1%0A%20%20%20%20activate_nm_conn%20ovs-if-br-ex1%0A%20%20fi%0Aelif%20%5B%20%22%241%22%20%3D%3D%20%22OpenShiftSDN%22%20%5D%3B%20then%0A%20%20%23%20Revert%20changes%20made%20by%20%2Fusr%2Flocal%2Fbin%2Fconfigure-ovs.sh%20during%20SDN%20migration.%0A%20%20rollback_nm%0A%20%20%0A%20%20%23%20Remove%20bridges%20created%20by%20ovn-kubernetes%0A%20%20ovs-vsctl%20--timeout%3D30%20--if-exists%20del-br%20br-int%20--%20--if-exists%20del-br%20br-local%0Afi%0A"
                        },
                        "mode": 493,
                        "overwrite": true,
                        "path": "/usr/local/bin/configure-ovs.sh"
                    },
                    {
                        "contents": {
                            "source": "data:,%23%20This%20file%20is%20generated%20by%20the%20Machine%20Config%20Operator's%20containerruntimeconfig%20controller.%0A%23%0A%23%20storage.conf%20is%20the%20configuration%20file%20for%20all%20tools%0A%23%20that%20share%20the%20containers%2Fstorage%20libraries%0A%23%20See%20man%205%20containers-storage.conf%20for%20more%20information%0A%23%20The%20%22container%20storage%22%20table%20contains%20all%20of%20the%20server%20options.%0A%5Bstorage%5D%0A%0A%23%20Default%20Storage%20Driver%0Adriver%20%3D%20%22overlay%22%0A%0A%23%20Temporary%20storage%20location%0Arunroot%20%3D%20%22%2Fvar%2Frun%2Fcontainers%2Fstorage%22%0A%0A%23%20Primary%20Read%2FWrite%20location%20of%20container%20storage%0Agraphroot%20%3D%20%22%2Fvar%2Flib%2Fcontainers%2Fstorage%22%0A%0A%5Bstorage.options%5D%0A%23%20Storage%20options%20to%20be%20passed%20to%20underlying%20storage%20drivers%0A%0A%23%20AdditionalImageStores%20is%20used%20to%20pass%20paths%20to%20additional%20Read%2FOnly%20image%20stores%0A%23%20Must%20be%20comma%20separated%20list.%0Aadditionalimagestores%20%3D%20%5B%0A%5D%0A%0A%23%20Size%20is%20used%20to%20set%20a%20maximum%20size%20of%20the%20container%20image.%20%20Only%20supported%20by%0A%23%20certain%20container%20storage%20drivers.%0Asize%20%3D%20%22%22%0A%0A%23%20Remap-UIDs%2FGIDs%20is%20the%20mapping%20from%20UIDs%2FGIDs%20as%20they%20should%20appear%20inside%20of%0A%23%20a%20container%2C%20to%20UIDs%2FGIDs%20as%20they%20should%20appear%20outside%20of%20the%20container%2C%20and%0A%23%20the%20length%20of%20the%20range%20of%20UIDs%2FGIDs.%20%20Additional%20mapped%20sets%20can%20be%20listed%0A%23%20and%20will%20be%20heeded%20by%20libraries%2C%20but%20there%20are%20limits%20to%20the%20number%20of%0A%23%20mappings%20which%20the%20kernel%20will%20allow%20when%20you%20later%20attempt%20to%20run%20a%0A%23%20container.%0A%23%0A%23%20remap-uids%20%3D%200%3A1668442479%3A65536%0A%23%20remap-gids%20%3D%200%3A1668442479%3A65536%0A%0A%23%20Remap-User%2FGroup%20is%20a%20name%20which%20can%20be%20used%20to%20look%20up%20one%20or%20more%20UID%2FGID%0A%23%20ranges%20in%20the%20%2Fetc%2Fsubuid%20or%20%2Fetc%2Fsubgid%20file.%20%20Mappings%20are%20set%20up%20starting%0A%23%20with%20an%20in-container%20ID%20of%200%20and%20the%20a%20host-level%20ID%20taken%20from%20the%20lowest%0A%23%20range%20that%20matches%20the%20specified%20name%2C%20and%20using%20the%20length%20of%20that%20range.%0A%23%20Additional%20ranges%20are%20then%20assigned%2C%20using%20the%20ranges%20which%20specify%20the%0A%23%20lowest%20host-level%20IDs%20first%2C%20to%20the%20lowest%20not-yet-mapped%20container-level%20ID%2C%0A%23%20until%20all%20of%20the%20entries%20have%20been%20used%20for%20maps.%0A%23%0A%23%20remap-user%20%3D%20%22storage%22%0A%23%20remap-group%20%3D%20%22storage%22%0A%0A%5Bstorage.options.thinpool%5D%0A%23%20Storage%20Options%20for%20thinpool%0A%0A%23%20autoextend_percent%20determines%20the%20amount%20by%20which%20pool%20needs%20to%20be%0A%23%20grown.%20This%20is%20specified%20in%20terms%20of%20%25%20of%20pool%20size.%20So%20a%20value%20of%2020%20means%0A%23%20that%20when%20threshold%20is%20hit%2C%20pool%20will%20be%20grown%20by%2020%25%20of%20existing%0A%23%20pool%20size.%0A%23%20autoextend_percent%20%3D%20%2220%22%0A%0A%23%20autoextend_threshold%20determines%20the%20pool%20extension%20threshold%20in%20terms%0A%23%20of%20percentage%20of%20pool%20size.%20For%20example%2C%20if%20threshold%20is%2060%2C%20that%20means%20when%0A%23%20pool%20is%2060%25%20full%2C%20threshold%20has%20been%20hit.%0A%23%20autoextend_threshold%20%3D%20%2280%22%0A%0A%23%20basesize%20specifies%20the%20size%20to%20use%20when%20creating%20the%20base%20device%2C%20which%0A%23%20limits%20the%20size%20of%20images%20and%20containers.%0A%23%20basesize%20%3D%20%2210G%22%0A%0A%23%20blocksize%20specifies%20a%20custom%20blocksize%20to%20use%20for%20the%20thin%20pool.%0A%23%20blocksize%3D%2264k%22%0A%0A%23%20directlvm_device%20specifies%20a%20custom%20block%20storage%20device%20to%20use%20for%20the%0A%23%20thin%20pool.%20Required%20if%20you%20setup%20devicemapper%0A%23%20directlvm_device%20%3D%20%22%22%0A%0A%23%20directlvm_device_force%20wipes%20device%20even%20if%20device%20already%20has%20a%20filesystem%0A%23%20directlvm_device_force%20%3D%20%22True%22%0A%0A%23%20fs%20specifies%20the%20filesystem%20type%20to%20use%20for%20the%20base%20device.%0A%23%20fs%3D%22xfs%22%0A%0A%23%20log_level%20sets%20the%20log%20level%20of%20devicemapper.%0A%23%200%3A%20LogLevelSuppress%200%20(Default)%0A%23%202%3A%20LogLevelFatal%0A%23%203%3A%20LogLevelErr%0A%23%204%3A%20LogLevelWarn%0A%23%205%3A%20LogLevelNotice%0A%23%206%3A%20LogLevelInfo%0A%23%207%3A%20LogLevelDebug%0A%23%20log_level%20%3D%20%227%22%0A%0A%23%20min_free_space%20specifies%20the%20min%20free%20space%20percent%20in%20a%20thin%20pool%20require%20for%0A%23%20new%20device%20creation%20to%20succeed.%20Valid%20values%20are%20from%200%25%20-%2099%25.%0A%23%20Value%200%25%20disables%0A%23%20min_free_space%20%3D%20%2210%25%22%0A%0A%23%20mkfsarg%20specifies%20extra%20mkfs%20arguments%20to%20be%20used%20when%20creating%20the%20base%0A%23%20device.%0A%23%20mkfsarg%20%3D%20%22%22%0A%0A%23%20mountopt%20specifies%20extra%20mount%20options%20used%20when%20mounting%20the%20thin%20devices.%0A%23%20mountopt%20%3D%20%22%22%0A%0A%23%20use_deferred_removal%20Marking%20device%20for%20deferred%20removal%0A%23%20use_deferred_removal%20%3D%20%22True%22%0A%0A%23%20use_deferred_deletion%20Marking%20device%20for%20deferred%20deletion%0A%23%20use_deferred_deletion%20%3D%20%22True%22%0A%0A%23%20xfs_nospace_max_retries%20specifies%20the%20maximum%20number%20of%20retries%20XFS%20should%0A%23%20attempt%20to%20complete%20IO%20when%20ENOSPC%20(no%20space)%20error%20is%20returned%20by%0A%23%20underlying%20storage%20device.%0A%23%20xfs_nospace_max_retries%20%3D%20%220%22%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/containers/storage.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,%23%20Proxy%20environment%20variables%20will%20be%20populated%20in%20this%20file.%20Properly%0A%23%20url%20encoded%20passwords%20with%20special%20characters%20will%20use%20'%25%3CHEX%3E%3CHEX%3E'.%0A%23%20Systemd%20requires%20that%20any%20%25%20used%20in%20a%20password%20be%20represented%20as%0A%23%20%25%25%20in%20a%20unit%20file%20since%20%25%20is%20a%20prefix%20for%20macros%3B%20this%20restriction%20does%20not%0A%23%20apply%20for%20environment%20files.%20Templates%20that%20need%20the%20proxy%20set%20should%20use%0A%23%20'EnvironmentFile%3D%2Fetc%2Fmco%2Fproxy.env'.%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/mco/proxy.env"
                    },
                    {
                        "contents": {
                            "source": "data:,%5BManager%5D%0ADefaultEnvironment%3DGODEBUG%3Dx509ignoreCN%3D0%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/systemd/system.conf.d/10-default-env-godebug.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,%23%20Force-load%20legacy%20iptables%20so%20it%20is%20usable%20from%20pod%20network%20namespaces%0Aip_tables%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/modules-load.d/iptables.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,NODE_SIZING_ENABLED%3Dfalse%0ASYSTEM_RESERVED_MEMORY%3D1Gi%0ASYSTEM_RESERVED_CPU%3D500m"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/node-sizing-enabled.env"
                    },
                    {
                        "contents": {
                            "source": "data:,%23!%2Fbin%2Fbash%0Aset%20-e%0ANODE_SIZES_ENV%3D%24%7BNODE_SIZES_ENV%3A-%2Fetc%2Fnode-sizing.env%7D%0Afunction%20dynamic_memory_sizing%20%7B%0A%20%20%20%20total_memory%3D%24(free%20-g%7Cawk%20'%2F%5EMem%3A%2F%7Bprint%20%242%7D')%0A%20%20%20%20%23%20total_memory%3D8%20test%20the%20recommended%20values%20by%20modifying%20this%20value%0A%20%20%20%20recommended_systemreserved_memory%3D0%0A%20%20%20%20if%20((%24total_memory%20%3C%3D%204))%3B%20then%20%23%2025%25%20of%20the%20first%204GB%20of%20memory%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D%24(echo%20%24total_memory%200.25%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%0A%20%20%20%20%20%20%20%20total_memory%3D0%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D1%0A%20%20%20%20%20%20%20%20total_memory%3D%24((total_memory-4))%0A%20%20%20%20fi%0A%20%20%20%20if%20((%24total_memory%20%3C%3D%204))%3B%20then%20%23%2020%25%20of%20the%20next%204GB%20of%20memory%20(up%20to%208GB)%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D%24(echo%20%24recommended_systemreserved_memory%20%24(echo%20%24total_memory%200.20%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_memory%3D0%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D%24(echo%20%24recommended_systemreserved_memory%200.80%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_memory%3D%24((total_memory-4))%0A%20%20%20%20fi%0A%20%20%20%20if%20((%24total_memory%20%3C%3D%208))%3B%20then%20%23%2010%25%20of%20the%20next%208GB%20of%20memory%20(up%20to%2016GB)%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D%24(echo%20%24recommended_systemreserved_memory%20%24(echo%20%24total_memory%200.10%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_memory%3D0%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D%24(echo%20%24recommended_systemreserved_memory%200.80%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_memory%3D%24((total_memory-8))%0A%20%20%20%20fi%0A%20%20%20%20if%20((%24total_memory%20%3C%3D%20112))%3B%20then%20%23%206%25%20of%20the%20next%20112GB%20of%20memory%20(up%20to%20128GB)%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D%24(echo%20%24recommended_systemreserved_memory%20%24(echo%20%24total_memory%200.06%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_memory%3D0%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D%24(echo%20%24recommended_systemreserved_memory%206.72%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_memory%3D%24((total_memory-112))%0A%20%20%20%20fi%0A%20%20%20%20if%20((%24total_memory%20%3E%3D%200))%3B%20then%20%23%202%25%20of%20any%20memory%20above%20128GB%0A%20%20%20%20%20%20%20%20recommended_systemreserved_memory%3D%24(echo%20%24recommended_systemreserved_memory%20%24(echo%20%24total_memory%200.02%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20fi%0A%20%20%20%20echo%20%22SYSTEM_RESERVED_MEMORY%3D%24%7Brecommended_systemreserved_memory%7DGi%22%3E%3E%20%24%7BNODE_SIZES_ENV%7D%0A%7D%0Afunction%20dynamic_cpu_sizing%20%7B%0A%20%20%20%20total_cpu%3D%24(getconf%20_NPROCESSORS_ONLN)%0A%20%20%20%20recommended_systemreserved_cpu%3D0%0A%20%20%20%20if%20((%24total_cpu%20%3C%3D%201))%3B%20then%20%23%206%25%20of%20the%20first%20core%0A%20%20%20%20%20%20%20%20recommended_systemreserved_cpu%3D%24(echo%20%24total_cpu%200.06%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%0A%20%20%20%20%20%20%20%20total_cpu%3D0%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20recommended_systemreserved_cpu%3D0.06%0A%20%20%20%20%20%20%20%20total_cpu%3D%24((total_cpu-1))%0A%20%20%20%20fi%0A%20%20%20%20if%20((%24total_cpu%20%3C%3D%201))%3B%20then%20%23%201%25%20of%20the%20next%20core%20(up%20to%202%20cores)%0A%20%20%20%20%20%20%20%20recommended_systemreserved_cpu%3D%24(echo%20%24recommended_systemreserved_cpu%20%24(echo%20%24total_cpu%200.01%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_cpu%3D0%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20recommended_systemreserved_cpu%3D%24(echo%20%24recommended_systemreserved_cpu%200.01%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_cpu%3D%24((total_cpu-1))%0A%20%20%20%20fi%0A%20%20%20%20if%20((%24total_cpu%20%3C%3D%202))%3B%20then%20%23%200.5%25%20of%20the%20next%202%20cores%20(up%20to%204%20cores)%0A%20%20%20%20%20%20%20%20recommended_systemreserved_cpu%3D%24(echo%20%24recommended_systemreserved_cpu%20%24(echo%20%24total_cpu%200.005%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_cpu%3D0%0A%20%20%20%20else%0A%20%20%20%20%20%20%20%20recommended_systemreserved_cpu%3D%24(echo%20%24recommended_systemreserved_cpu%200.01%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20%20%20%20%20total_cpu%3D%24((total_cpu-2))%0A%20%20%20%20fi%0A%20%20%20%20if%20((%24total_cpu%20%3E%3D%200))%3B%20then%20%23%200.25%25%20of%20any%20cores%20above%204%20cores%0A%20%20%20%20%20%20%20%20recommended_systemreserved_cpu%3D%24(echo%20%24recommended_systemreserved_cpu%20%24(echo%20%24total_cpu%200.0025%20%7C%20awk%20'%7Bprint%20%241%20*%20%242%7D')%20%7C%20awk%20'%7Bprint%20%241%20%2B%20%242%7D')%0A%20%20%20%20fi%0A%20%20%20%20echo%20%22SYSTEM_RESERVED_CPU%3D%24%7Brecommended_systemreserved_cpu%7D%22%3E%3E%20%24%7BNODE_SIZES_ENV%7D%0A%7D%0Afunction%20dynamic_ephemeral_sizing%20%7B%0A%20%20%20%20echo%20%22Not%20implemented%20yet%22%0A%7D%0Afunction%20dynamic_pid_sizing%20%7B%0A%20%20%20%20echo%20%22Not%20implemented%20yet%22%0A%7D%0Afunction%20dynamic_node_sizing%20%7B%0A%20%20%20%20rm%20-f%20%24%7BNODE_SIZES_ENV%7D%0A%20%20%20%20dynamic_memory_sizing%0A%20%20%20%20dynamic_cpu_sizing%0A%20%20%20%20%23dynamic_ephemeral_sizing%0A%20%20%20%20%23dynamic_pid_sizing%0A%7D%0Afunction%20static_node_sizing%20%7B%0A%20%20%20%20rm%20-f%20%24%7BNODE_SIZES_ENV%7D%0A%20%20%20%20echo%20%22SYSTEM_RESERVED_MEMORY%3D%241%22%20%3E%3E%20%24%7BNODE_SIZES_ENV%7D%0A%20%20%20%20echo%20%22SYSTEM_RESERVED_CPU%3D%242%22%20%3E%3E%20%24%7BNODE_SIZES_ENV%7D%0A%7D%0A%0Aif%20%5B%20%241%20%3D%3D%20%22true%22%20%5D%3B%20then%0A%20%20%20%20dynamic_node_sizing%0Aelif%20%5B%20%241%20%3D%3D%20%22false%22%20%5D%3B%20then%0A%20%20%20%20static_node_sizing%20%242%20%243%0Aelse%0A%20%20%20%20echo%20%22Unrecongnized%20command%20line%20option.%20Valid%20options%20are%20%5C%22true%5C%22%20or%20%5C%22false%5C%22%22%0Afi%0A"
                        },
                        "mode": 493,
                        "overwrite": true,
                        "path": "/usr/local/sbin/dynamic-system-reserved-calc.sh"
                    },
                    {
                        "contents": {
                            "source": "data:,-----BEGIN%20CERTIFICATE-----%0AMIIDMDCCAhigAwIBAgIIMb%2FfcQ%2BNpeQwDQYJKoZIhvcNAQELBQAwNjESMBAGA1UE%0ACxMJb3BlbnNoaWZ0MSAwHgYDVQQDExdhZG1pbi1rdWJlY29uZmlnLXNpZ25lcjAe%0AFw0yMjAyMTcxNDE4MzBaFw0zMjAyMTUxNDE4MzBaMDYxEjAQBgNVBAsTCW9wZW5z%0AaGlmdDEgMB4GA1UEAxMXYWRtaW4ta3ViZWNvbmZpZy1zaWduZXIwggEiMA0GCSqG%0ASIb3DQEBAQUAA4IBDwAwggEKAoIBAQC%2BN%2FBpd9V1XyCYeg4586ZNuGITTvAd0zoa%0AbYeQjX58Ddt5kMqqgWs%2FpmQDKkEqPMoifDc4q3nwN3I4FaqGvSpfUDkN2BuZmAWF%0A7WKx5Ukaqp3manJ%2F%2FuFX4kbb9j0jfK5I0Sv0TmTUuB2SgcJClKiuXGV4zwWXF5Qf%0AH3PNxqZMbViEZU7ziXyiomMhwhD%2FqjJEa%2Bl1cKw2WR1n7SiozNjgm759qDH6eGhB%0APscuXILvMW6Q77bLXlXUCzhy9F7N1od2goMteJ%2B3TAFcUWIQZpo%2B8rGivkZphUTG%0A%2BR38XSMGWoK5Yd4GSHdTu0NA9ymdbefQXPBWMrbMQRRM9UwD4EgTAgMBAAGjQjBA%0AMA4GA1UdDwEB%2FwQEAwICpDAPBgNVHRMBAf8EBTADAQH%2FMB0GA1UdDgQWBBQKpPiq%0A5fjrbMbIDQXFR1jretnPjjANBgkqhkiG9w0BAQsFAAOCAQEAp6povc7iPshiqW4T%0A9tFdYhXvwKx22m%2BcUBQ5hQl78cpusZW8eXNvgOlluQQK4NznO0RfL3JKpSe7zTua%0A8n2fqIukMAoOjWM9zTfrOHr9pLg11y2%2FyM2%2BKA%2FUhFgdI69ci5l0su1gloQrefsz%0Ah20kDBelbfUmKYUK4egiW0N7tBhlZks9fpKfgrZdwA1MmXORTJx0gX4PQS2bg6xL%0Ay1dcKi3bE1qxI77U3nfd3Vxufw7EWaqnsG4L3jwES9SJHxQpai4IuMzTDIzO7FcR%0APSDP8pisFQ9oaN6ZS%2FPY5%2B%2F0xRmC5S0WY1%2BZoRXsyQxLUSO1r%2BnY8Ud4d03Owa%2BP%0APfGzkw%3D%3D%0A-----END%20CERTIFICATE-----%0A-----BEGIN%20CERTIFICATE-----%0AMIIDHjCCAgagAwIBAgIIGtL68gFn1Z8wDQYJKoZIhvcNAQELBQAwLTESMBAGA1UE%0ACxMJb3BlbnNoaWZ0MRcwFQYDVQQDEw5rdWJlbGV0LXNpZ25lcjAeFw0yMjAyMTcx%0ANDE4MzVaFw0yMjAyMTgxNDE4MzVaMC0xEjAQBgNVBAsTCW9wZW5zaGlmdDEXMBUG%0AA1UEAxMOa3ViZWxldC1zaWduZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK%0AAoIBAQDy929thH5yxiUgxhwluzxNv%2BGoMyVex%2BgofAKxDWmdFwMS3khb7XkacBvT%0A3YAuJYeRJVdigHeKLxZEFCrtqpYK4G7rUjmzIhlsXSO06OQUMFJSCftsIY3y6VrD%0AfBPhHSMmQ9HFpIu7O56wa9lkPeYUxx63lPDpTb%2Bpp21VkRfG4kX%2BgMziasWUEDid%0AOypRdRFAZIE%2FEQjUasuF2zWJSzPq1h9%2BOsKV%2FlIfEL6H2JLp9ckjSoWhNd9NgPY%2B%0A9IamDwrizDUHE48K%2FKWxUxE%2FZJ2lfdGpdj%2BPSk8RONOoKtw5DC5q9fd1fZMkhNbQ%0AMMIWxspNeN0M%2FFy0rJ3IRJ914auPAgMBAAGjQjBAMA4GA1UdDwEB%2FwQEAwICpDAP%0ABgNVHRMBAf8EBTADAQH%2FMB0GA1UdDgQWBBSUfmmS2%2BvE7jy13RDcei7%2BbE%2B1wTAN%0ABgkqhkiG9w0BAQsFAAOCAQEAJnInNwBCDMmT1Bv6tsxHjfyZxP719mVZ7Hngn8W8%0AeKyvYhGg0%2FiSF98LEmgl7vTGryfJAgtT9g3jt8ce961Y0Hat%2BNZE5%2FXd5B8IY%2ByZ%0Aab9dh8ax%2B%2BkJIK8mlglvRDWB7rN2ztiM1C7FnYA%2BPwWoL1ACMk0mmf%2BNkrylySls%0AeeA1OBgSFHC3UxD5Ag5%2BSOvICi2sGfcy%2FX2VVnkO9cocsKbpZywGQ6etdNbl26%2FF%0ACsHTPUbDdSom3RrQLD9rB7JqfqSmE2J9XHvRVP4KzNDFJxKL2Mo6jLzQQl7%2BKqcx%0AwfSGkLT9KERb2QP2re46viaoY0jqC0zLjRfVRaNxLrn%2BJw%3D%3D%0A-----END%20CERTIFICATE-----%0A-----BEGIN%20CERTIFICATE-----%0AMIIDNDCCAhygAwIBAgIIGNMKMoeKM4EwDQYJKoZIhvcNAQELBQAwODESMBAGA1UE%0ACxMJb3BlbnNoaWZ0MSIwIAYDVQQDExlrdWJlLWNvbnRyb2wtcGxhbmUtc2lnbmVy%0AMB4XDTIyMDIxNzE0MTgzNloXDTIzMDIxNzE0MTgzNlowODESMBAGA1UECxMJb3Bl%0AbnNoaWZ0MSIwIAYDVQQDExlrdWJlLWNvbnRyb2wtcGxhbmUtc2lnbmVyMIIBIjAN%0ABgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApq%2ByuZVWgdqGSMNhe8yoAI%2ByWqGB%0ASnpM1Y%2Fav886tCcSmdn1NwOaSnFzaU5t8cH7vVhsZpmpgrWFIR8xNu7cK3%2FRAcje%0ABK0UiGftsiVoULpRbSpuMGHA1UIWSkWaBlvHP4uubmzpJ9n%2BE9JWCSUfAvdWM4m8%0ASB6BcZ48tlkTBTrmg%2FiizAN0T5Y9x4ZGJ68AN41O0sKrggtMMu9RplXXERYcXho1%0AepdheBCvjSGXSiJMlJG8BR0roM3jm6qM0X%2BW0mEHN%2F6Krh0ARSGIfKw2%2BRGS7krG%0AujBZaV%2FU8LOgHyESeLsZDlKr1DX903pUyn6KnYUh2byfzzI3Ax%2FAjQjiGwIDAQAB%0Ao0IwQDAOBgNVHQ8BAf8EBAMCAqQwDwYDVR0TAQH%2FBAUwAwEB%2FzAdBgNVHQ4EFgQU%0AAJqL6XYGtolMygUtwbYTxsbAGZcwDQYJKoZIhvcNAQELBQADggEBAFurA8oFd%2Fig%0AKnPkwZXbWjwLp3zI2nY4W6HXbOXWAKtfjcCvezqRyW7afhzJ%2FuFvompAjr5aWTyO%0AGIXpTYdJZcfxxTVfGQjPUzdWzWrBPIItRgRZ1hbwLPH9%2FG%2FvuI6kR5YfmMXGmoC9%0AY9dBYkyLo35cyKRApdnkgbHHn27wTKYlXAMGolAj%2Bejw6vJx9Cb0bN6m3g4QXAOh%0AspM27c2xY7GeTcTJU6avMocqmjFU9hiimyQWShDGIOSp8O%2BIkjtWnhtvFWJoQ59A%0AHgMJE9FE7eOsmv5Z1R%2BTvjahpboqdJvJ%2BmYoj5D426P4yOuAclyysOXKw%2Fxhrdq8%0AP%2Bafvgx%2Btac%3D%0A-----END%20CERTIFICATE-----%0A-----BEGIN%20CERTIFICATE-----%0AMIIDQjCCAiqgAwIBAgIIJShgaa3FgnUwDQYJKoZIhvcNAQELBQAwPzESMBAGA1UE%0ACxMJb3BlbnNoaWZ0MSkwJwYDVQQDEyBrdWJlLWFwaXNlcnZlci10by1rdWJlbGV0%0ALXNpZ25lcjAeFw0yMjAyMTcxNDE4MzZaFw0yMzAyMTcxNDE4MzZaMD8xEjAQBgNV%0ABAsTCW9wZW5zaGlmdDEpMCcGA1UEAxMga3ViZS1hcGlzZXJ2ZXItdG8ta3ViZWxl%0AdC1zaWduZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDP9R2DA7uC%0AegSjovdReZOBSqp%2FlJodDD%2BJ%2FXke3GneO17YqYHOKfI3Dsf8nwy7ttPbM3K1BZ3x%0ASYVmOOCdSfPwt2v1Etw%2FohNLkUpOrzaXzAhFmswADm3Ws2YIvhUT33wkFBeog7US%0AE4s3Kn8zqhHu8Dn6wT%2Btlv04zbxAoG2Q6q1awTonB8cL6PG%2FixqN8jbZFSHcP0k4%0A665k6zkN9MTR6eC2cPMeB4CGEXMu%2BUOjA4DICe%2Bx5StQw%2BvOPu9VGNkOfSY64yZC%0APdPWel4Axv5Yo0%2B30STnduUl6VXFjenSIA0J9xs5yPAh0gBYEugm2rQqnluo8S9X%0A2jVTsaAZ6G2vAgMBAAGjQjBAMA4GA1UdDwEB%2FwQEAwICpDAPBgNVHRMBAf8EBTAD%0AAQH%2FMB0GA1UdDgQWBBQA3R6BKa8j%2BD9n2DSZe2JGxmUIqzANBgkqhkiG9w0BAQsF%0AAAOCAQEAVkU8HdrNDekrM%2BVJ4vyVGyYdCJfJJdY6ND0o7cy5wrBPPeEguxRGuL2B%0AAO3oun3iHBUKHJ4shZSNq0%2B763T0W%2FxMdr0O03I8sN7inRTKhvs%2FOCdysygyvoqD%0ArnpXKpPfI2ahGt9aVbqGD7M0fp8N7Hl16jUNwCHfLNrPnT%2F7XN4Y7ptwsKmKCJsA%0ASrqpDobkv46sDu9miGY013ceztYdjptNNDQdr%2BEMz7gHxRJUzldu5n2G6OvCv%2BAw%0AB07kSKIfXvr2oKw%2FZHcdUAZdNePi57YCzsGe51MEWC8xAmJrmd%2Fsg%2FAY8Et8XWlZ%0AIEJQqRj0BC51I%2BF0f8QJnP0J4R2B3w%3D%3D%0A-----END%20CERTIFICATE-----%0A-----BEGIN%20CERTIFICATE-----%0AMIIDSDCCAjCgAwIBAgIIBggxGlOqWLowDQYJKoZIhvcNAQELBQAwQjESMBAGA1UE%0ACxMJb3BlbnNoaWZ0MSwwKgYDVQQDEyNrdWJlbGV0LWJvb3RzdHJhcC1rdWJlY29u%0AZmlnLXNpZ25lcjAeFw0yMjAyMTcxNDE4MzFaFw0zMjAyMTUxNDE4MzFaMEIxEjAQ%0ABgNVBAsTCW9wZW5zaGlmdDEsMCoGA1UEAxMja3ViZWxldC1ib290c3RyYXAta3Vi%0AZWNvbmZpZy1zaWduZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCq%0AxPNIGOUDS47BxEBfTTK%2FIj9rrjUZ0lUQbESglC6Y1ht7mQCql6ap6i3qiDgXMqdy%0AOkmOLS56tgr%2BFkGt8fGbxxaxDamlJEii0Q7YMI6oxdZojP5M7q%2FA1rO8GFXiP5iH%0Aind13yGdC4v88vOzhlGRvYaj9xrL514pxX4giZe3vDl2FC%2FqTBipWgIHVNQ2gQsY%0A6LbyzbKcGMIc0%2BHLjNFCpBSbSe%2Bmr51EnN81Vf3McOpzezme23PplBiduZTpMALY%0AsMXrhvz%2FC%2F%2F94rd26Stnwv%2Bn%2FMaiHNVV%2FX%2BUtGe32m9y5%2BnI9DBk%2Fc9z2GEkFXVH%0AiYoPIvaFHDuLfwN0rDUxAgMBAAGjQjBAMA4GA1UdDwEB%2FwQEAwICpDAPBgNVHRMB%0AAf8EBTADAQH%2FMB0GA1UdDgQWBBQSsqcES8LOzYvWMjbSTnic3LhHXzANBgkqhkiG%0A9w0BAQsFAAOCAQEAfaO1QnXDnWg0eMV8CDnfRc4KKBGGMMa82ej2C8rQcMtbYUu8%0AetMZu8P14Z2VTOil22%2Fqp06cm98d4lNx%2FpjeIeyX1deBMk4KWk9cWDO22l74l5fV%0Aw7GFhcQzy232wIleFBVwsbMsHeXT3901P%2Bgt7O8WnksTOF6D4jGXiYKeI7ckT4u8%0AXNj5WRHOPks9W5L7rSWNcmYk4c3bYKB53Jj36x1AikAm7QBO3kK8RLsIW1inLUzR%0AYAG6msVEM3xqMGqBGUMXrr1ebLpaubA8qC%2FlaE2nyIVder2wP7b2MzlhZf7chVdx%0ACSDGIllP8%2Fj7SAd9iN%2Ft9v%2F%2FpNnKpV2B21Bg0A%3D%3D%0A-----END%20CERTIFICATE-----%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/kubernetes/kubelet-ca.crt"
                    },
                    {
                        "contents": {
                            "source": "data:,%23%20Turning%20on%20Accounting%20helps%20track%20down%20performance%20issues.%0A%5BManager%5D%0ADefaultCPUAccounting%3Dyes%0ADefaultMemoryAccounting%3Dyes%0ADefaultBlockIOAccounting%3Dyes%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/systemd/system.conf.d/kubelet-cgroups.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,%5BService%5D%0AEnvironment%3D%22KUBELET_LOG_LEVEL%3D2%22%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/systemd/system/kubelet.service.d/20-logging.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,%23%20ignore%20known%20SDN-managed%20devices%0A%5Bdevice%5D%0Amatch-device%3Dinterface-name%3Abr-int%3Binterface-name%3Abr-local%3Binterface-name%3Abr-nexthop%2Cinterface-name%3Aovn-k8s-*%2Cinterface-name%3Ak8s-*%3Binterface-name%3Atun0%3Binterface-name%3Abr0%3Bdriver%3Aveth%0Amanaged%3D0%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/NetworkManager/conf.d/sdn.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,%7B%22auths%22%3A%7B%22cloud.openshift.com%22%3A%7B%22auth%22%3A%22b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K2plcnpoYW5ncmVkaGF0Y29tMWVmcnQzanh3Y2N1dXB1c3ZibDhrcnY2amF2OlE3TVlZU1g4UzhLM0VONEI0SUxVQkpIVVVWTFNQN1NXMjlJVURLNFFOTzdOVDBaUTRWTVdDUTA4REwxT0tKM0w%3D%22%2C%22email%22%3A%22jerzhang%40redhat.com%22%7D%2C%22quay.io%22%3A%7B%22auth%22%3A%22b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K2plcnpoYW5ncmVkaGF0Y29tMWVmcnQzanh3Y2N1dXB1c3ZibDhrcnY2amF2OlE3TVlZU1g4UzhLM0VONEI0SUxVQkpIVVVWTFNQN1NXMjlJVURLNFFOTzdOVDBaUTRWTVdDUTA4REwxT0tKM0w%3D%22%2C%22email%22%3A%22jerzhang%40redhat.com%22%7D%2C%22registry.connect.redhat.com%22%3A%7B%22auth%22%3A%22NTIxMjQ1OTR8dWhjLTFFZnJUM2pYV2NDVVVQVVNWQkw4a3J2NkphdjpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSXpPV1F4WldFNVpHUTBZVEkwTkRjeVlqRTJOemswWm1SaU1HWXlOelJsTVNKOS5EZmxxSkxTRDc0X29faERfLVFoTEpMb0FnQXRIR09fTUFBRUhXVWZSOUZYMzRMa2prUWl1Yjh2dTJsVHFaMVg0UFdVSlI5aF9NLXUtUklHaHdfQkNBRjN1aDU5YWp1Y1E4YjF5NWw1Ny1rYzdQSWs1Qk1hb2FhR3NZTTYyRHdFc0ZKd1RNRWQyM3ZRMlZ5VEVGVkNEZHVqX0t0SC1GcWhld044eWNUVFl4dVlkb3Q4eWEyQTZOQ3l4SDVsZGNhQy0wX0puOXBERDVSb1BxTzI0a3FjRlJZSlNJbXIzYnl5RV9RenhYWWgxc0VCMHkwQ1dCMG9iU2lMXzZJQnVqRkJnWHVIZ1FodGhlaFdHX2ptMWQwWkNXYVFUd3dZMU45QU9OMUNpdTh0MG9KWEJKZnRLZVpkOVlHUDNkcFExNDJYSXBvd1ZDcFktNEl0dlNtb0dQWjFrcEdNa2U3V0FaNjY2S0h1cjRpZGhXQk9nR19meXZOWlp6b1pFVFdZTUZubjhmRktCYmcxZldwbjI5Q3dETHpydHpHVmcwbVdLZnNMUU9ESm10clVDZHNBSXQ3QVMwdTQ3cnlCODVWcUpUbXJzdm5kenljeWJQdHFfRFV3RjBZUDc4OWlTejdmSUFDbktmZG1DN1psRS1scVVpVGVoLVpVQm9GangzdUtfYk4yVXV5Z2ZCUXQxQmtfc21Id3FBMEJTM2RzSlpwUGJVWVI2ZHB1MVpFTUt6cFBIMm9XYXVTRE1HOGRjaFdFOHBjblhLWUpuQkhvekdLcXdZcEhoZjdkSkxKbWF0U056TTNmOFVEcl84dE9CZmRxZ0FzU0tSZWpQTGZHQlF1Q3BSTU50Y1pCcWRGTUl3R0JCQkE0OENub3ZBTF9jOTJKbGVRRzJZNmR3YjJkZEtPaw%3D%3D%22%2C%22email%22%3A%22jerzhang%40redhat.com%22%7D%2C%22registry.redhat.io%22%3A%7B%22auth%22%3A%22NTIxMjQ1OTR8dWhjLTFFZnJUM2pYV2NDVVVQVVNWQkw4a3J2NkphdjpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSXpPV1F4WldFNVpHUTBZVEkwTkRjeVlqRTJOemswWm1SaU1HWXlOelJsTVNKOS5EZmxxSkxTRDc0X29faERfLVFoTEpMb0FnQXRIR09fTUFBRUhXVWZSOUZYMzRMa2prUWl1Yjh2dTJsVHFaMVg0UFdVSlI5aF9NLXUtUklHaHdfQkNBRjN1aDU5YWp1Y1E4YjF5NWw1Ny1rYzdQSWs1Qk1hb2FhR3NZTTYyRHdFc0ZKd1RNRWQyM3ZRMlZ5VEVGVkNEZHVqX0t0SC1GcWhld044eWNUVFl4dVlkb3Q4eWEyQTZOQ3l4SDVsZGNhQy0wX0puOXBERDVSb1BxTzI0a3FjRlJZSlNJbXIzYnl5RV9RenhYWWgxc0VCMHkwQ1dCMG9iU2lMXzZJQnVqRkJnWHVIZ1FodGhlaFdHX2ptMWQwWkNXYVFUd3dZMU45QU9OMUNpdTh0MG9KWEJKZnRLZVpkOVlHUDNkcFExNDJYSXBvd1ZDcFktNEl0dlNtb0dQWjFrcEdNa2U3V0FaNjY2S0h1cjRpZGhXQk9nR19meXZOWlp6b1pFVFdZTUZubjhmRktCYmcxZldwbjI5Q3dETHpydHpHVmcwbVdLZnNMUU9ESm10clVDZHNBSXQ3QVMwdTQ3cnlCODVWcUpUbXJzdm5kenljeWJQdHFfRFV3RjBZUDc4OWlTejdmSUFDbktmZG1DN1psRS1scVVpVGVoLVpVQm9GangzdUtfYk4yVXV5Z2ZCUXQxQmtfc21Id3FBMEJTM2RzSlpwUGJVWVI2ZHB1MVpFTUt6cFBIMm9XYXVTRE1HOGRjaFdFOHBjblhLWUpuQkhvekdLcXdZcEhoZjdkSkxKbWF0U056TTNmOFVEcl84dE9CZmRxZ0FzU0tSZWpQTGZHQlF1Q3BSTU50Y1pCcWRGTUl3R0JCQkE0OENub3ZBTF9jOTJKbGVRRzJZNmR3YjJkZEtPaw%3D%3D%22%2C%22email%22%3A%22jerzhang%40redhat.com%22%7D%2C%22registry.ci.openshift.org%22%3A%7B%22auth%22%3A%22dXNlcjpzaGEyNTZ%2BRGJvNV9sSG9Ea3pnN2x5UlE4WVdEbkF3SEpGZXZKRThkV0ZYNy15SFotNA%3D%3D%22%7D%2C%22registry.build01.ci.openshift.org%22%3A%7B%22auth%22%3A%22dXNlcjpzaGEyNTZ%2BNEtFSkRZejd3VUZXWWdreDFBUU9PUjMzQkF2X09hV2k0UmZDa2cwb0NNOA%3D%3D%22%7D%2C%22registry.svc.ci.openshift.org%22%3A%7B%22auth%22%3A%22dXNlcjpyZFhtTndfdXo5SlNXNm94Z2tuelBaV3hIeFc0eW1pRkYtSDJrYVdHWVBF%22%7D%2C%22https%3A%2F%2Findex.docker.io%2Fv1%2F%22%3A%7B%22auth%22%3A%22amVyemhhbmc6ZTZlYTEzZTYtZGFhNC00OWE1LTgxOGEtYzdjOThlMjgzMTNj%22%7D%7D%7D%0A"
                        },
                        "mode": 384,
                        "overwrite": true,
                        "path": "/var/lib/kubelet/config.json"
                    },
                    {
                        "contents": {
                            "source": "data:,-----BEGIN%20CERTIFICATE-----%0AMIIDEDCCAfigAwIBAgIIZOcPJzddEfwwDQYJKoZIhvcNAQELBQAwJjESMBAGA1UE%0ACxMJb3BlbnNoaWZ0MRAwDgYDVQQDEwdyb290LWNhMB4XDTIyMDIxNzE0MTgzMloX%0ADTMyMDIxNTE0MTgzMlowJjESMBAGA1UECxMJb3BlbnNoaWZ0MRAwDgYDVQQDEwdy%0Ab290LWNhMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvVZ8%2FsfiX0Du%0AcQY%2FfQq2r%2BmpJvXNqLNeENRey%2F6KKMu4sU29jkUpf1cFpKji29zvCRf5FWXhUXyc%0Ah0jyaXI%2Fv2262d7dyhfPWxeybmsbTaAb8CuM4zWsGSjuYhTTi0LEoyg5iv9Qa%2BXd%0ApvQEJblzfXiIE7sRDXvUaWdkdvkWuuXix18RP9JilxTdIg%2BVpyMMBYYF%2F0Vatzb8%0A8ktOyGKgpbltOTwIPsHx6lDBE8Q%2FYilFBqHNcd%2Bnfmpez9tFu2ntvbAPRpUTWYHn%0AWCuyWwuEgi8Tp2OAG5FzCxRHz20AlOu5odrq9ciMbxIM6%2BQWKo6BCZ6LIUgS9AnX%0ARL14Z1a%2B7wIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAqQwDwYDVR0TAQH%2FBAUwAwEB%0A%2FzAdBgNVHQ4EFgQUBjf80BZOe%2BMcXK94R%2BDl%2FJDL%2BxwwDQYJKoZIhvcNAQELBQAD%0AggEBALZkejpu6htTo0tdkSa5t8q6ZFQcWsGBwnCOjt798986dXT%2BmM4WfAGXXQpk%0Akm8F%2F%2BHm%2BC9oiX%2F28lxTyQCN8pMvWsq%2BpOljdNGChKHDEZ5AlHmgHuToAV2CHjee%0AlL%2BKzNixxWWWpkJv26cWM4g7vJpq3pZAEcbzsUm0uKdsxRLxktj5AedHaha%2Bx5QQ%0AVD9FTBDEYnyN8Qi%2Fr3%2F0CjYGuPYBbmBRVF1N3x6ori%2F1GgBmmEZdRYNnnRfW5AYf%0A0VZfM57MDpRW33v4QQYe6b9cdnMUzWZRotOzPem9fMbw39xUL%2F6kPa3gHENPu8me%0AStRUwiI1da6fyH%2FDO8ZFp%2FRkwhw%3D%0A-----END%20CERTIFICATE-----%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/kubernetes/ca.crt"
                    },
                    {
                        "contents": {
                            "source": "data:,net.ipv4.ip_forward%20%3D%201%0Anet.ipv6.conf.all.forwarding%20%3D%201%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/sysctl.d/forward.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,%0Afs.inotify.max_user_watches%20%3D%2065536%0Afs.inotify.max_user_instances%20%3D%208192%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/sysctl.d/inotify.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,%23!%2Fbin%2Fbash%0Aset%20-e%20-o%20pipefail%0A%0ANODECONF%3D%2Fetc%2Fsystemd%2Fsystem%2Fkubelet.service.d%2F20-aws-node-name.conf%0A%0Aif%20%5B%20-e%20%22%24%7BNODECONF%7D%22%20%5D%3B%20then%0A%20%20%20%20echo%20%22Not%20replacing%20existing%20%24%7BNODECONF%7D%22%0A%20%20%20%20exit%200%0Afi%0A%0A%23%20For%20compatibility%20with%20the%20AWS%20in-tree%20provider%0A%23%20Set%20node%20name%20to%20be%20instance%20name%20instead%20of%20the%20default%20FQDN%20hostname%0A%23%0A%23%20https%3A%2F%2Fdocs.aws.amazon.com%2FAWSEC2%2Flatest%2FUserGuide%2Finstancedata-data-retrieval.html%0Aname%3D%24(curl%20-s%20http%3A%2F%2F169.254.169.254%2F2016-09-02%2Fmeta-data%2Flocal-hostname)%0Acat%20%3E%20%22%24%7BNODECONF%7D%22%20%3C%3CEOF%0A%5BService%5D%0AEnvironment%3D%22KUBELET_NODE_NAME%3D%24%7Bname%7D%22%0AEOF%0A"
                        },
                        "mode": 493,
                        "overwrite": true,
                        "path": "/usr/local/bin/aws-kubelet-nodename"
                    },
                    {
                        "contents": {
                            "source": "data:,%23!%2Fbin%2Fbash%0A%23%20First%2C%20we%20need%20to%20wait%20until%20DHCP%20finishes%20and%20the%20node%20has%20a%20non-%60localhost%60%0A%23%20hostname%20before%20%60kubelet.service%60%20starts.%0A%23%20That's%20the%20%60--wait%60%20argument%20as%20used%20by%20%60node-valid-hostname.service%60.%0A%23%0A%23%20Second%2C%20on%20GCP%20specifically%20we%20truncate%20the%20hostname%20if%20it's%20%3E63%20characters.%0A%23%20That's%20%60gcp-hostname.service%60.%0A%0A%23%20Block%20indefinitely%20until%20the%20host%20gets%20a%20non-localhost%20name.%0A%23%20Note%20node-valid-hostname.service%20uses%20systemd%20to%20abort%20if%20this%20takes%20too%20long.%0Await_localhost()%20%7B%0A%20%20%20%20echo%20%22waiting%20for%20non-localhost%20hostname%20to%20be%20assigned%22%0A%20%20%20%20while%20%5B%5B%20%22%24(%3C%20%2Fproc%2Fsys%2Fkernel%2Fhostname)%22%20%3D~%20(localhost%7Clocalhost.localdomain)%20%5D%5D%3B%0A%20%20%20%20do%0A%20%20%20%20%20%20%20%20sleep%201%0A%20%20%20%20done%0A%20%20%20%20echo%20%22node%20identified%20as%20%24(%3C%2Fproc%2Fsys%2Fkernel%2Fhostname)%22%0A%20%20%20%20exit%200%0A%7D%0A%0Aset_gcp_hostname()%20%7B%0A%20%20%20%20%2Fusr%2Fbin%2Fafterburn%20--provider%20gcp%20--hostname%3D%2Frun%2Fafterburn.hostname%0A%0A%20%20%20%20local%20host_name%3D%24(cat%20%2Frun%2Fafterburn.hostname)%0A%20%20%20%20local%20type_arg%3D%22transient%22%0A%0A%20%20%20%20%23%20%2Fetc%2Fhostname%20is%20used%20for%20static%20hostnames%20and%20is%20authoritative.%0A%20%20%20%20%23%20This%20will%20check%20to%20make%20sure%20that%20the%20static%20hostname%20is%20the%0A%20%20%20%20%23%20less%20than%20or%20equal%20to%2063%20characters%20in%20length.%0A%20%20%20%20if%20%5B%20-f%20%2Fetc%2Fhostname%20%5D%20%26%26%20%5B%20%22%24(cat%20%2Fetc%2Fhostname%20%7C%20wc%20-m)%22%20-gt%200%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20etc_name%3D%22%24(%3C%20%2Fetc%2Fhostname)%22%0A%20%20%20%20%20%20%20%20type_arg%3D%22static%22%0A%20%20%20%20%20%20%20%20if%20%5B%20%22%24%7Betc_name%7D%22%20!%3D%20%22%24%7Bhost_name%7D%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%2Fetc%2Fhostname%20is%20set%20to%20%24%7Betc_name%7D%20but%20does%20not%20match%20%24%7Bhost_name%7D%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22using%20%2Fetc%2Fhostname%20as%20the%20authoritative%20name%22%0A%20%20%20%20%20%20%20%20%20%20%20%20host_name%3D%22%24%7Betc_name%7D%22%0A%20%20%20%20%20%20%20%20fi%0A%20%20%20%20fi%0A%0A%20%20%20%20%23%20Only%20mutate%20the%20hostname%20if%20the%20length%20is%20longer%20than%2063%20characters.%20The%0A%20%20%20%20%23%20hostname%20will%20be%20the%20lesser%20of%2063%20characters%20after%20the%20first%20dot%20in%20the%0A%20%20%20%20%23%20FQDN.%20%20This%20algorithm%20is%20only%20known%20to%20work%20in%20GCP%2C%20and%20hence%20is%20only%0A%20%20%20%20%23%20executed%20in%20GCP.%0A%20%20%20%20if%20%5B%20%22%24%7B%23host_name%7D%22%20-gt%2063%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20alt_name%3D%24(printf%20%22%24%7Bhost_name%7D%22%20%7C%20cut%20-f1%20-d'.'%20%7C%20cut%20-c%20-63)%0A%20%20%20%20%20%20%20%20echo%20%22%24%7Bhost_name%7D%20is%20longer%20than%2063%20characters%2C%20using%20truncated%20hostname%22%0A%20%20%20%20%20%20%20%20host_name%3D%22%24%7Balt_name%7D%22%0A%20%20%20%20fi%0A%20%20%20%20echo%20%22setting%20%24%7Btype_arg%7D%20hostname%20to%20%24%7Bhost_name%7D%22%0A%20%20%20%20%2Fbin%2Fhostnamectl%20%22--%24%7Btype_arg%7D%22%20set-hostname%20%22%24%7Bhost_name%7D%22%0A%20%20%20%20exit%200%0A%7D%0A%0Aarg%3D%24%7B1%7D%3B%20shift%3B%0Acase%20%22%24%7Barg%7D%22%20in%0A%20%20%20%20--wait)%20wait_localhost%3B%3B%0A%20%20%20%20--gcp)%20set_gcp_hostname%3B%3B%0A%20%20%20%20*)%20echo%20%22Unhandled%20arg%20%24arg%22%3B%20exit%201%0Aesac%0A"
                        },
                        "mode": 493,
                        "overwrite": true,
                        "path": "/usr/local/bin/mco-hostname"
                    },
                    {
                        "contents": {
                            "source": "data:,"
                        },
                        "mode": 493,
                        "overwrite": true,
                        "path": "/etc/kubernetes/kubelet-plugins/volume/exec/.dummy"
                    },
                    {
                        "contents": {
                            "source": "data:,%23!%2Fbin%2Fbash%0A%23%20Workaround%3A%0A%23%20https%3A%2F%2Fbugzilla.redhat.com%2Fshow_bug.cgi%3Fid%3D1941714%0A%23%20https%3A%2F%2Fbugzilla.redhat.com%2Fshow_bug.cgi%3Fid%3D1935539%0A%23%20https%3A%2F%2Fbugzilla.redhat.com%2Fshow_bug.cgi%3Fid%3D1987108%0A%0Adriver%3D%24(nmcli%20-t%20-m%20tabular%20-f%20general.driver%20dev%20show%20%22%24%7BDEVICE_IFACE%7D%22)%0A%0Aif%20%5B%5B%20%22%242%22%20%3D%3D%20%22up%22%20%26%26%20%22%24%7Bdriver%7D%22%20%3D%3D%20%22vmxnet3%22%20%5D%5D%3B%20then%0A%20%20logger%20-s%20%2299-vsphere-disable-tx-udp-tnl%20triggered%20by%20%24%7B2%7D%20on%20device%20%24%7BDEVICE_IFACE%7D.%22%0A%20%20ethtool%20-K%20%24%7BDEVICE_IFACE%7D%20tx-udp_tnl-segmentation%20off%0A%20%20ethtool%20-K%20%24%7BDEVICE_IFACE%7D%20tx-udp_tnl-csum-segmentation%20off%0A%20%20ethtool%20-K%20%24%7BDEVICE_IFACE%7D%20tx-checksum-ip-generic%20off%0Afi%0A"
                        },
                        "mode": 484,
                        "overwrite": true,
                        "path": "/etc/NetworkManager/dispatcher.d/99-vsphere-disable-tx-udp-tnl"
                    },
                    {
                        "contents": {
                            "source": "data:,unqualified-search-registries%20%3D%20%5B'registry.access.redhat.com'%2C%20'docker.io'%5D%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/containers/registries.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,%5Bcrio%5D%0Ainternal_wipe%20%3D%20true%0Aversion_file_persist%20%3D%20%22%2Fvar%2Flib%2Fcrio%2Fversion%22%0A%0A%5Bcrio.api%5D%0Astream_address%20%3D%20%22%22%0Astream_port%20%3D%20%2210010%22%0A%0A%5Bcrio.runtime%5D%0Aselinux%20%3D%20true%0Aconmon%20%3D%20%22%22%0Aconmon_cgroup%20%3D%20%22pod%22%0Adefault_env%20%3D%20%5B%0A%20%20%20%20%22NSS_SDB_USE_CACHE%3Dno%22%2C%0A%5D%0Alog_level%20%3D%20%22info%22%0Acgroup_manager%20%3D%20%22systemd%22%0Adefault_sysctls%20%3D%20%5B%0A%20%20%20%20%22net.ipv4.ping_group_range%3D0%202147483647%22%2C%0A%5D%0Ahooks_dir%20%3D%20%5B%0A%20%20%20%20%22%2Fetc%2Fcontainers%2Foci%2Fhooks.d%22%2C%0A%20%20%20%20%22%2Frun%2Fcontainers%2Foci%2Fhooks.d%22%2C%0A%20%20%20%20%22%2Fusr%2Fshare%2Fcontainers%2Foci%2Fhooks.d%22%2C%0A%5D%0Amanage_ns_lifecycle%20%3D%20true%0Aabsent_mount_sources_to_reject%20%3D%20%5B%0A%20%20%20%20%22%2Fetc%2Fhostname%22%2C%0A%5D%0Adrop_infra_ctr%20%3D%20true%0A%0A%5Bcrio.runtime.workloads.openshift-builder%5D%0Aactivation_annotation%20%3D%20%22io.openshift.builder%22%0Aallowed_annotations%20%3D%20%5B%0A%20%20%22io.kubernetes.cri-o.userns-mode%22%2C%0A%20%20%22io.kubernetes.cri-o.Devices%22%0A%5D%0A%5Bcrio.runtime.workloads.openshift-builder.resources%5D%0A%0A%5Bcrio.image%5D%0Aglobal_auth_file%20%3D%20%22%2Fvar%2Flib%2Fkubelet%2Fconfig.json%22%0Apause_image%20%3D%20%22quay.io%2Fopenshift-release-dev%2Focp-v4.0-art-dev%40sha256%3Abfa295c67ade9ee09776834941c35a5a3375a4be8811ebd8dc072dd0b20f9e27%22%0Apause_image_auth_file%20%3D%20%22%2Fvar%2Flib%2Fkubelet%2Fconfig.json%22%0Apause_command%20%3D%20%22%2Fusr%2Fbin%2Fpod%22%0A%0A%5Bcrio.network%5D%0Anetwork_dir%20%3D%20%22%2Fetc%2Fkubernetes%2Fcni%2Fnet.d%2F%22%0Aplugin_dirs%20%3D%20%5B%0A%20%20%20%20%22%2Fvar%2Flib%2Fcni%2Fbin%22%2C%0A%20%20%20%20%22%2Fusr%2Flibexec%2Fcni%22%2C%0A%5D%0A%0A%5Bcrio.metrics%5D%0Aenable_metrics%20%3D%20true%0Ametrics_port%20%3D%209537%0Ametrics_collectors%20%3D%20%5B%0A%20%20%22operations%22%2C%0A%20%20%22operations_latency_microseconds_total%22%2C%0A%20%20%22operations_latency_microseconds%22%2C%0A%20%20%22operations_errors%22%2C%0A%20%20%22image_pulls_layer_size%22%2C%0A%20%20%22containers_oom_total%22%2C%0A%20%20%22containers_oom%22%2C%0A%20%20%23%20Drop%20metrics%20with%20excessive%20label%20cardinality.%0A%20%20%23%20%22image_pulls_by_digest%22%2C%0A%20%20%23%20%22image_pulls_by_name%22%2C%0A%20%20%23%20%22image_pulls_by_name_skipped%22%2C%0A%20%20%23%20%22image_pulls_failures%22%2C%0A%20%20%23%20%22image_pulls_successes%22%2C%0A%20%20%23%20%22image_layer_reuse%22%2C%0A%5D%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/crio/crio.conf.d/00-default"
                    },
                    {
                        "contents": {
                            "source": "data:,%7B%0A%20%20%20%20%22default%22%3A%20%5B%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22insecureAcceptAnything%22%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%5D%2C%0A%20%20%20%20%22transports%22%3A%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22docker-daemon%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%22%3A%20%5B%7B%22type%22%3A%22insecureAcceptAnything%22%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%7D"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/containers/policy.json"
                    },
                    {
                        "contents": {
                            "source": "data:,"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/kubernetes/cloud.conf"
                    },
                    {
                        "contents": {
                            "source": "data:,kind%3A%20KubeletConfiguration%0AapiVersion%3A%20kubelet.config.k8s.io%2Fv1beta1%0Aauthentication%3A%0A%20%20x509%3A%0A%20%20%20%20clientCAFile%3A%20%2Fetc%2Fkubernetes%2Fkubelet-ca.crt%0A%20%20anonymous%3A%0A%20%20%20%20enabled%3A%20false%0AcgroupDriver%3A%20systemd%0AcgroupRoot%3A%20%2F%0AclusterDNS%3A%0A%20%20-%20172.30.0.10%0AclusterDomain%3A%20cluster.local%0AcontainerLogMaxSize%3A%2050Mi%0AmaxPods%3A%20250%0AkubeAPIQPS%3A%2050%0AkubeAPIBurst%3A%20100%0ArotateCertificates%3A%20true%0AserializeImagePulls%3A%20false%0AstaticPodPath%3A%20%2Fetc%2Fkubernetes%2Fmanifests%0AsystemCgroups%3A%20%2Fsystem.slice%0AsystemReserved%3A%0A%20%20ephemeral-storage%3A%201Gi%0AfeatureGates%3A%0A%20%20APIPriorityAndFairness%3A%20true%0A%20%20LegacyNodeRoleBehavior%3A%20false%0A%20%20NodeDisruptionExclusion%3A%20true%0A%20%20RotateKubeletServerCertificate%3A%20true%0A%20%20ServiceNodeExclusion%3A%20true%0A%20%20SupportPodPidsLimit%3A%20true%0A%20%20DownwardAPIHugePages%3A%20true%0A%20%20PodSecurity%3A%20true%0A%20%20CSIMigrationAWS%3A%20false%0A%20%20CSIMigrationAzureDisk%3A%20false%0A%20%20CSIMigrationAzureFile%3A%20false%0A%20%20CSIMigrationGCE%3A%20false%0A%20%20CSIMigrationOpenStack%3A%20false%0A%20%20CSIMigrationvSphere%3A%20false%0AserverTLSBootstrap%3A%20true%0AtlsMinVersion%3A%20VersionTLS12%0AtlsCipherSuites%3A%0A%20%20-%20TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256%0A%20%20-%20TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256%0A%20%20-%20TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384%0A%20%20-%20TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384%0A%20%20-%20TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256%0A%20%20-%20TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256%0A"
                        },
                        "mode": 420,
                        "overwrite": true,
                        "path": "/etc/kubernetes/kubelet.conf"
                    }
                ]
            },
            "systemd": {
                "units": [
                    {
                        "contents": "[Unit]\nDescription=Fetch kubelet node name from AWS Metadata\n# Wait for NetworkManager to report it's online\nAfter=NetworkManager-wait-online.service\n# Run before kubelet\nBefore=kubelet.service\n\n[Service]\nExecStart=/usr/local/bin/aws-kubelet-nodename\nType=oneshot\n\n[Install]\nWantedBy=network-online.target\n",
                        "enabled": true,
                        "name": "aws-kubelet-nodename.service"
                    },
                    {
                        "dropins": [
                            {
                                "contents": "",
                                "name": "10-mco-default-env.conf"
                            },
                            {
                                "contents": "[Service]\nEnvironment=\"ENABLE_PROFILE_UNIX_SOCKET=true\"\n",
                                "name": "10-mco-profile-unix-socket.conf"
                            },
                            {
                                "contents": "[Service]\nEnvironment=\"GODEBUG=x509ignoreCN=0,madvdontneed=1\"\n",
                                "name": "10-mco-default-madv.conf"
                            }
                        ],
                        "name": "crio.service"
                    },
                    {
                        "dropins": [
                            {
                                "contents": "[Unit]\nConditionPathExists=/enoent\n",
                                "name": "mco-disabled.conf"
                            }
                        ],
                        "name": "docker.socket"
                    },
                    {
                        "contents": "[Unit]\nDescription=Dynamically sets the system reserved for the kubelet\nWants=network-online.target\nAfter=network-online.target ignition-firstboot-complete.service\nBefore=kubelet.service crio.service\n[Service]\n# Need oneshot to delay kubelet\nType=oneshot\nRemainAfterExit=yes\nEnvironmentFile=/etc/node-sizing-enabled.env\nExecStart=/bin/bash /usr/local/sbin/dynamic-system-reserved-calc.sh ${NODE_SIZING_ENABLED} ${SYSTEM_RESERVED_MEMORY} ${SYSTEM_RESERVED_CPU}\n[Install]\nRequiredBy=kubelet.service\n",
                        "enabled": true,
                        "name": "kubelet-auto-node-size.service"
                    },
                    {
                        "contents": "[Unit]\nDescription=Kubernetes Kubelet\nWants=rpc-statd.service network-online.target\nRequires=crio.service kubelet-auto-node-size.service\nAfter=network-online.target crio.service kubelet-auto-node-size.service\nAfter=ostree-finalize-staged.service\n\n[Service]\nType=notify\nExecStartPre=/bin/mkdir --parents /etc/kubernetes/manifests\nExecStartPre=/bin/rm -f /var/lib/kubelet/cpu_manager_state\nExecStartPre=/bin/rm -f /var/lib/kubelet/memory_manager_state\nEnvironmentFile=/etc/os-release\nEnvironmentFile=-/etc/kubernetes/kubelet-workaround\nEnvironmentFile=-/etc/kubernetes/kubelet-env\nEnvironmentFile=/etc/node-sizing.env\n\nExecStart=/usr/bin/hyperkube \\\n    kubelet \\\n      --config=/etc/kubernetes/kubelet.conf \\\n      --bootstrap-kubeconfig=/etc/kubernetes/kubeconfig \\\n      --kubeconfig=/var/lib/kubelet/kubeconfig \\\n      --container-runtime=remote \\\n      --container-runtime-endpoint=/var/run/crio/crio.sock \\\n      --runtime-cgroups=/system.slice/crio.service \\\n      --node-labels=node-role.kubernetes.io/worker,node.openshift.io/os_id=${ID} \\\n      --node-ip=${KUBELET_NODE_IP} \\\n      --minimum-container-ttl-duration=6m0s \\\n      --volume-plugin-dir=/etc/kubernetes/kubelet-plugins/volume/exec \\\n      --cloud-provider=aws \\\n       \\\n      --hostname-override=${KUBELET_NODE_NAME} \\\n      --pod-infra-container-image=quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:bfa295c67ade9ee09776834941c35a5a3375a4be8811ebd8dc072dd0b20f9e27 \\\n      --system-reserved=cpu=${SYSTEM_RESERVED_CPU},memory=${SYSTEM_RESERVED_MEMORY} \\\n      --v=${KUBELET_LOG_LEVEL}\n\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n",
                        "dropins": [
                            {
                                "contents": "",
                                "name": "10-mco-default-env.conf"
                            },
                            {
                                "contents": "[Service]\nEnvironment=\"GODEBUG=x509ignoreCN=0,madvdontneed=1\"\n",
                                "name": "10-mco-default-madv.conf"
                            }
                        ],
                        "enabled": true,
                        "name": "kubelet.service"
                    },
                    {
                        "contents": "[Unit]\nDescription=Machine Config Daemon Firstboot\n# Make sure it runs only on OSTree booted system\nConditionPathExists=/run/ostree-booted\n# Removal of this file signals firstboot completion\nConditionPathExists=/etc/ignition-machine-config-encapsulated.json\nAfter=machine-config-daemon-pull.service\nBefore=crio.service kubelet.service\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\n# Disable existing repos (if any) so that OS extensions would use embedded RPMs only\nExecStartPre=-/usr/bin/sh -c \"sed -i 's/enabled=1/enabled=0/' /etc/yum.repos.d/*.repo\"\nExecStart=/run/bin/machine-config-daemon firstboot-complete-machineconfig\n[Install]\nWantedBy=multi-user.target\nRequiredBy=crio.service kubelet.service\n",
                        "enabled": true,
                        "name": "machine-config-daemon-firstboot.service"
                    },
                    {
                        "contents": "[Unit]\nDescription=Machine Config Daemon Pull\n# Make sure it runs only on OSTree booted system\nConditionPathExists=/run/ostree-booted\n# This \"stamp file\" is unlinked when we complete\n# machine-config-daemon-firstboot.service\nConditionPathExists=/etc/ignition-machine-config-encapsulated.json\n# Run after crio-wipe so the pulled MCD image is protected against a corrupted storage from a forced shutdown\nWants=network-online.target crio-wipe.service\nAfter=network-online.target crio-wipe.service\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\n# See https://github.com/coreos/fedora-coreos-tracker/issues/354\nExecStart=/bin/sh -c '/bin/mkdir -p /run/bin \u0026\u0026 chcon --reference=/usr/bin /run/bin'\nExecStart=/bin/sh -c \"while ! /usr/bin/podman pull --authfile=/var/lib/kubelet/config.json --quiet 'quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:62b0101633bc21b6bcc102921b6dc07e1f04552980cb6026da218d4f32eb449e'; do sleep 1; done\"\nExecStart=/usr/bin/podman run --rm --quiet --net=host -v /run/bin:/host/run/bin:z --entrypoint=cp 'quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:62b0101633bc21b6bcc102921b6dc07e1f04552980cb6026da218d4f32eb449e' /usr/bin/machine-config-daemon /host/run/bin\nExecStart=/bin/chcon system_u:object_r:bin_t:s0 /run/bin/machine-config-daemon\n[Install]\nRequiredBy=machine-config-daemon-firstboot.service\n",
                        "enabled": true,
                        "name": "machine-config-daemon-pull.service"
                    },
                    {
                        "contents": "[Unit]\nDescription=Wait for a non-localhost hostname\nBefore=network-online.target\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nUser=root\nExecStart=/usr/local/bin/mco-hostname --wait\n\n# Wait up to 5min for the node to get a non-localhost name\nTimeoutSec=300\n\n[Install]\nWantedBy=multi-user.target\n# Ensure that network-online.target will not complete until the node has a non-localhost hostname.\nRequiredBy=network-online.target\n",
                        "enabled": true,
                        "name": "node-valid-hostname.service"
                    },
                    {
                        "contents": "[Unit]\nDescription=Writes IP address configuration so that kubelet and crio services select a valid node IP\nWants=network-online.target crio-wipe.service\nAfter=network-online.target ignition-firstboot-complete.service crio-wipe.service\nBefore=kubelet.service crio.service\n\n[Service]\n# Need oneshot to delay kubelet\nType=oneshot\n# Would prefer to do Restart=on-failure instead of this bash retry loop, but\n# the version of systemd we have right now doesn't support it. It should be\n# available in systemd v244 and higher.\nExecStart=/bin/bash -c \" \\\n  until \\\n  /usr/bin/podman run --rm \\\n  --authfile /var/lib/kubelet/config.json \\\n  --net=host \\\n  --volume /etc/systemd/system:/etc/systemd/system:z \\\n  quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:784cb6796adc967dad4027bd060d9546291af2b2dc7de1dbd3cacb3b07636b36 \\\n  node-ip \\\n  set \\\n  --retry-on-failure; \\\n  do \\\n  sleep 5; \\\n  done\"\nExecStart=/bin/systemctl daemon-reload\n\n[Install]\nRequiredBy=kubelet.service\n",
                        "enabled": false,
                        "name": "nodeip-configuration.service"
                    },
                    {
                        "enabled": true,
                        "name": "openvswitch.service"
                    },
                    {
                        "contents": "[Unit]\nDescription=Configures OVS with proper host networking configuration\n# Removal of this file signals firstboot completion\nConditionPathExists=!/etc/ignition-machine-config-encapsulated.json\n# This service is used to move a physical NIC into OVS and reconfigure OVS to use the host IP\nRequires=openvswitch.service\nWants=NetworkManager-wait-online.service\nAfter=NetworkManager-wait-online.service openvswitch.service network.service\nBefore=network-online.target kubelet.service crio.service node-valid-hostname.service\n\n[Service]\n# Need oneshot to delay kubelet\nType=oneshot\nExecStart=/usr/local/bin/configure-ovs.sh OpenShiftSDN\nStandardOutput=journal+console\nStandardError=journal+console\n\n[Install]\nWantedBy=network-online.target\n",
                        "enabled": true,
                        "name": "ovs-configuration.service"
                    },
                    {
                        "dropins": [
                            {
                                "contents": "[Service]\nRestart=always\nExecStartPre=-/bin/sh -c '/usr/bin/chown -R :$${OVS_USER_ID##*:} /var/lib/openvswitch'\nExecStartPre=-/bin/sh -c '/usr/bin/chown -R :$${OVS_USER_ID##*:} /etc/openvswitch'\nExecStartPre=-/bin/sh -c '/usr/bin/chown -R :$${OVS_USER_ID##*:} /run/openvswitch'\nExecStartPost=-/usr/bin/ovs-appctl vlog/set syslog:info\nExecReload=-/usr/bin/ovs-appctl vlog/set syslog:info\n",
                                "name": "10-ovs-vswitchd-restart.conf"
                            }
                        ],
                        "name": "ovs-vswitchd.service"
                    },
                    {
                        "dropins": [
                            {
                                "contents": "[Service]\nRestart=always\n",
                                "name": "10-ovsdb-restart.conf"
                            }
                        ],
                        "enabled": true,
                        "name": "ovsdb-server.service"
                    },
                    {
                        "dropins": [
                            {
                                "contents": "",
                                "name": "10-mco-default-env.conf"
                            }
                        ],
                        "name": "pivot.service"
                    },
                    {
                        "dropins": [
                            {
                                "contents": "[Unit]\nConditionPathExists=/enoent\n",
                                "name": "mco-disabled.conf"
                            }
                        ],
                        "name": "zincati.service"
                    }
                ]
            }
        },
        "kernelArguments": [],
        "extensions": [],
        "fips": false,
        "kernelType": "default"
    }
}
